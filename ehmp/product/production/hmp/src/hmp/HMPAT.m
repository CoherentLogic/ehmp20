HMPAT ;ASMR/EJK,ASF,CK - ASU/TIU Trigger to HMP Activity File;May 15, 2016 14:15
 ;;2.0;ENTERPRISE HEALTH MANAGEMENT PLATFORM;**1**;May 15, 2016;Build 1
 ;Per VA Directive 6402, this routine should not be modified.
 ;
 ; DE2818 - SQA findings. Newed HMPRSLT in ECLASS+10.  RRB - 10/27/2015
 Q
ECLASS(HMPIEN) ; called from EDIT^USRCLASS,ADD^USRRULA
 N HMPSYS,TYPE,HMPMAX,HMPI,HMPID,HMPERR,HMPRSLT,HMPTN,HMPLAST,HMPCNT,HMPFINI,HMPFRSP,HMPARGS
 N $ES,$ET,ERRMSG
 S HMPID=$P($G(USRDATA),U,2)
 S HMP=$NA(^TMP("HMP",$J)),HMPI=0 K @HMP
 S HMPSYS=$$SYS^HMPUTILS
 S (HMPMAX,HMPLAST,HMPID)="",HMPCNT=0
 S HMPARGS("server")=$O(^HMP(800000,"B",""))
 S HMPARGS("command")="startOperationalDataExtract"
 S HMPARGS("domains")="asu-class"
 D API^HMPDJFS(.HMPRSLT,.HMPARGS)
 Q
 ;
ERULE ; called from EDIT1^USRRULA
 N HMPSYS,TYPE,HMPMAX,HMPI,HMPID,HMPERR,HMPTN,HMPLAST,HMPCNT,HMPFINI,HMPFRSP,HMPARGS
 N $ES,$ET,ERRMSG
 S HMP=$NA(^TMP("HMP",$J)),HMPI=0 K @HMP
 S HMPSYS=$$SYS^HMPUTILS
 S (HMPMAX,HMPLAST,HMPID)="",HMPCNT=0
 S HMPARGS("server")=$O(^HMP(800000,"B",""))
 S HMPARGS("command")="startOperationalDataExtract"
 S HMPARGS("domains")="asu-rule"
 D API^HMPDJFS(.HMPRSLT,.HMPARGS)
 Q
 ;
EDEF ; called from option TIU DOCUMENT DEFINITION EDIT
 N HMPDA
 S HMPDA=$P(XQLOK,",",2),HMPDA=$TR(HMPDA,")","")
 ; DE2818 begin change ASF 11/9/15
 ;I HMPDA?1N.N,$D(^TIU(8925.1,HMPDA)) D POSTX^HMPEVNT("doc-def",HMPDA)
 ;I HMPDA?1N.N,'$D(^TIU(8925.1,HMPDA)) D POSTX^HMPEVNT("doc-def",HMPDA,"@")
 N DA,DIC,DIQ,DR,R  ; FileMan variables
 S DIC=8925.1,DR=.01,DA=HMPDA,DIQ="R" D EN^DIQ1
 D:$D(R(8925.1,DA,.01)) POSTX^HMPEVNT("doc-def",HMPDA)
 D:'$D(R(8925.1,DA,.01)) POSTX^HMPEVNT("doc-def",HMPDA,"@")
 ; DE2818 end change
 Q
