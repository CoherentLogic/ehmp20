KIDS Distribution saved on Apr 14, 2015@08:22:43
PRE-HMP PATCHES
**KIDS**:HMPM*2.0*1^MD*1.0*38^OR*3.0*390^PSB*3.0*79^TIU*1.0*106^GMRC*3.0*80^

**INSTALL NAME**
HMPM*2.0*1
"BLD",9073,0)
HMPM*2.0*1^^1^3150414^n
"BLD",9073,6.3)
22
"BLD",9073,10,0)
^9.63^5^5
"BLD",9073,10,1,0)
MD*1.0*38^1
"BLD",9073,10,2,0)
OR*3.0*390^1
"BLD",9073,10,3,0)
PSB*3.0*79^1
"BLD",9073,10,4,0)
TIU*1.0*106^1
"BLD",9073,10,5,0)
GMRC*3.0*80^1
"BLD",9073,10,"B","GMRC*3.0*80",5)

"BLD",9073,10,"B","MD*1.0*38",1)

"BLD",9073,10,"B","OR*3.0*390",2)

"BLD",9073,10,"B","PSB*3.0*79",3)

"BLD",9073,10,"B","TIU*1.0*106",4)

"MBREQ")
0
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"VER")
8.0^22.0
**INSTALL NAME**
MD*1.0*38
"BLD",9063,0)
MD*1.0*38^CLINICAL PROCEDURES^0^3150414^y
"BLD",9063,1,0)
^^2^2^3131219^
"BLD",9063,1,1,0)
This patch creates an event for broadcasting new or updated data in the
"BLD",9063,1,2,0)
Clinical Observations (CLiO) module.
"BLD",9063,4,0)
^9.64PA^^
"BLD",9063,6.3)
274
"BLD",9063,"INIT")
EN^MDPOST38
"BLD",9063,"KRN",0)
^9.67PA^779.2^20
"BLD",9063,"KRN",.4,0)
.4
"BLD",9063,"KRN",.401,0)
.401
"BLD",9063,"KRN",.402,0)
.402
"BLD",9063,"KRN",.403,0)
.403
"BLD",9063,"KRN",.5,0)
.5
"BLD",9063,"KRN",.84,0)
.84
"BLD",9063,"KRN",3.6,0)
3.6
"BLD",9063,"KRN",3.8,0)
3.8
"BLD",9063,"KRN",9.2,0)
9.2
"BLD",9063,"KRN",9.8,0)
9.8
"BLD",9063,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",9063,"KRN",9.8,"NM",1,0)
MDCPROTD^^0^B6599959
"BLD",9063,"KRN",9.8,"NM","B","MDCPROTD",1)

"BLD",9063,"KRN",19,0)
19
"BLD",9063,"KRN",19.1,0)
19.1
"BLD",9063,"KRN",101,0)
101
"BLD",9063,"KRN",101,"NM",0)
^9.68A^1^1
"BLD",9063,"KRN",101,"NM",1,0)
MDC OBSERVATION UPDATE^^0
"BLD",9063,"KRN",101,"NM","B","MDC OBSERVATION UPDATE",1)

"BLD",9063,"KRN",409.61,0)
409.61
"BLD",9063,"KRN",771,0)
771
"BLD",9063,"KRN",779.2,0)
779.2
"BLD",9063,"KRN",870,0)
870
"BLD",9063,"KRN",8989.51,0)
8989.51
"BLD",9063,"KRN",8989.52,0)
8989.52
"BLD",9063,"KRN",8994,0)
8994
"BLD",9063,"KRN","B",.4,.4)

"BLD",9063,"KRN","B",.401,.401)

"BLD",9063,"KRN","B",.402,.402)

"BLD",9063,"KRN","B",.403,.403)

"BLD",9063,"KRN","B",.5,.5)

"BLD",9063,"KRN","B",.84,.84)

"BLD",9063,"KRN","B",3.6,3.6)

"BLD",9063,"KRN","B",3.8,3.8)

"BLD",9063,"KRN","B",9.2,9.2)

"BLD",9063,"KRN","B",9.8,9.8)

"BLD",9063,"KRN","B",19,19)

"BLD",9063,"KRN","B",19.1,19.1)

"BLD",9063,"KRN","B",101,101)

"BLD",9063,"KRN","B",409.61,409.61)

"BLD",9063,"KRN","B",771,771)

"BLD",9063,"KRN","B",779.2,779.2)

"BLD",9063,"KRN","B",870,870)

"BLD",9063,"KRN","B",8989.51,8989.51)

"BLD",9063,"KRN","B",8989.52,8989.52)

"BLD",9063,"KRN","B",8994,8994)

"BLD",9063,"QUES",0)
^9.62^^
"BLD",9063,"REQB",0)
^9.611^^
"INIT")
EN^MDPOST38
"KRN",101,6088,-1)
0^1
"KRN",101,6088,0)
MDC OBSERVATION UPDATE^Observation update notification^^X^^^^^^^^CLINICAL PROCEDURES
"KRN",101,6088,1,0)
^101.06^16^16^3141223^^
"KRN",101,6088,1,1,0)
This protocol will be triggered when an observation in the OBS file 
"KRN",101,6088,1,2,0)
enters or leaves VERIFIED status.
"KRN",101,6088,1,3,0)
 
"KRN",101,6088,1,4,0)
The local array "MDCOBS" will be populated as follows:
"KRN",101,6088,1,5,0)
 
"KRN",101,6088,1,6,0)
MDCOBS("OBS_ID","E")="{35627230-5C66-49E3-AD93-97C269CB257D}"
"KRN",101,6088,1,7,0)
MDCOBS("OBS_ID","I")="{35627230-5C66-49E3-AD93-97C269CB257D}"
"KRN",101,6088,1,8,0)
MDCOBS("OLD_STATUS","E")="Verified"
"KRN",101,6088,1,9,0)
MDCOBS("OLD_STATUS","I")=1
"KRN",101,6088,1,10,0)
MDCOBS("PATIENT_ID","E")="SIMPSON,BARTHOLOMUE"
"KRN",101,6088,1,11,0)
MDCOBS("PATIENT_ID","I")=2
"KRN",101,6088,1,12,0)
MDCOBS("STATUS","E")="Unverified"
"KRN",101,6088,1,13,0)
MDCOBS("STATUS","I")=0
"KRN",101,6088,1,14,0)
 
"KRN",101,6088,1,15,0)
In case of an error, MDCOBS("ERROR") will be populated with the error 
"KRN",101,6088,1,16,0)
number and error text from FileMan.
"KRN",101,6088,5)

"KRN",101,6088,10,0)
^101.01PA^12^3
"KRN",101,6088,20)
D EN^MDCPROTD
"KRN",101,6088,99)
63656,23225
"KRN",101,6088,775,0)
^101.0775PA^^
"MBREQ")
1
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"PKG",557,-1)
1^1
"PKG",557,0)
CLINICAL PROCEDURES^MD^Clinical Procedures
"PKG",557,20,0)
^9.402P^^
"PKG",557,22,0)
^9.49I^1^1
"PKG",557,22,1,0)
1.0^3040429^3050121^10000000020
"PKG",557,22,1,"PAH",1,0)
38^3150414^1
"PKG",557,22,1,"PAH",1,1,0)
^^2^2^3150414
"PKG",557,22,1,"PAH",1,1,1,0)
This patch creates an event for broadcasting new or updated data in the
"PKG",557,22,1,"PAH",1,1,2,0)
Clinical Observations (CLiO) module.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","MDCPROTD")
0^1^B6599959
"RTN","MDCPROTD",1,0)
MDCPROTD ;HINES OIFO/BLJ - CliO backend driver;02 Feb 2005 ; 12/12/13 8:52pm
"RTN","MDCPROTD",2,0)
 ;;1.0;CLINICAL PROCEDURES;**38**;Apr 01, 2004;Build 274
"RTN","MDCPROTD",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MDCPROTD",4,0)
 ;
"RTN","MDCPROTD",5,0)
 ; External References -
"RTN","MDCPROTD",6,0)
 ;  EN^XQOR - IA # 10101
"RTN","MDCPROTD",7,0)
 ;
"RTN","MDCPROTD",8,0)
EN ;
"RTN","MDCPROTD",9,0)
 ; First, we'll get the root observation.
"RTN","MDCPROTD",10,0)
 New MDCERR,IEN
"RTN","MDCPROTD",11,0)
 Set IEN=$Get(DA) If '+IEN Write "IEN FOR PROTOCOL UNDEFINED!",! Quit
"RTN","MDCPROTD",12,0)
 Do GETS^DIQ(704.117,IEN_",",".01;.08;.09","EINR","^TMP(""MDCOBS"",$J)","MDCERR")
"RTN","MDCPROTD",13,0)
 If $Data(MDCERR) Do  Quit
"RTN","MDCPROTD",14,0)
 . Set MDCOBS("ERROR")=$Get(MDCERR("DIERR",1))_U_$Get(MDCERR("DIERR",1,"TEXT",1))
"RTN","MDCPROTD",15,0)
 Merge MDCOBS=^TMP("MDCOBS",$J,704.117,IEN_",") Kill ^TMP("MDCOBS",$J)
"RTN","MDCPROTD",16,0)
 Set MDCOBS("OLD_STATUS","E")=$$EXTERNAL^DILFD(704.117,".09",,$Get(X1))
"RTN","MDCPROTD",17,0)
 Set MDCOBS("OLD_STATUS","I")=X1
"RTN","MDCPROTD",18,0)
 Set MDCOBS("DOMAIN","VITALS")=0
"RTN","MDCPROTD",19,0)
 Set MDGUID=$$GET1^DIQ(704.117,IEN_",",.07)
"RTN","MDCPROTD",20,0)
 For Y=1:1 Quit:$Text(MAP+Y)=""  If $Piece($Text(MAP+Y),";",4)=MDGUID Set MDCOBS("DOMAIN","VITALS")=1 Quit
"RTN","MDCPROTD",21,0)
 Quit
"RTN","MDCPROTD",22,0)
 ;
"RTN","MDCPROTD",23,0)
PROT ;Call the protocol.
"RTN","MDCPROTD",24,0)
 Set X="MDC OBSERVATION UPDATE",DIC="101"
"RTN","MDCPROTD",25,0)
 Do EN^XQOR
"RTN","MDCPROTD",26,0)
 Quit
"RTN","MDCPROTD",27,0)
 ;
"RTN","MDCPROTD",28,0)
 ; This must be updated if Vitals EVER adds a new term that we map to. This only says our term it paired with a vital sign.
"RTN","MDCPROTD",29,0)
 ;
"RTN","MDCPROTD",30,0)
MAP ; Contains the mappings from Vitals to CliO - vital;abbv;vuid;term_guid
"RTN","MDCPROTD",31,0)
 ;;ABDOMINAL GIRTH;{F70E6642-2719-22BE-BE87-DEF0A884F177}
"RTN","MDCPROTD",32,0)
 ;;AUDIOMETRY;{FFD29134-8BB2-248E-0412-93C2C08B076F}
"RTN","MDCPROTD",33,0)
 ;;BLOOD PRESSURE;{B15F2DF6-CE99-B847-FE6B-3D5F174A2BCD}
"RTN","MDCPROTD",34,0)
 ;;CENTRAL VENOUS PRESSURE;{D30F98A7-4C5D-12E8-AB4D-9C85A4332EC3}
"RTN","MDCPROTD",35,0)
 ;;CIRCUMFERENCE/GIRTH;{92A124D4-B75F-9FD9-1A51-605887BCEA79};
"RTN","MDCPROTD",36,0)
 ;;FETAL HEART TONES;{A2E22A44-E924-ADDE-2B8E-0251666B4DE6}
"RTN","MDCPROTD",37,0)
 ;;FUNDAL HEIGHT;{EEAB8762-624F-7BA3-4001-114FD229BA69}
"RTN","MDCPROTD",38,0)
 ;;HEAD CIRCUMFERENCE;{33827E3C-5DBB-083C-D8BE-4DFD7D42071F}
"RTN","MDCPROTD",39,0)
 ;;HEARING;{813CCC94-3D64-5093-BC6C-053EFD9948F9}
"RTN","MDCPROTD",40,0)
 ;;HEIGHT;{B440216B-0FB3-1950-7859-7C1BE398FE4A}
"RTN","MDCPROTD",41,0)
 ;;PAIN;{47A83DEA-BA95-38AD-DF2E-1F209122E684}
"RTN","MDCPROTD",42,0)
 ;;PULSE;{FCA63B76-EF4C-EBE5-33C1-F1EEBD7A7BC4}
"RTN","MDCPROTD",43,0)
 ;;PULSE OXIMETRY;{5F84DD55-3CCF-094C-2536-B51EB7FAD999}
"RTN","MDCPROTD",44,0)
 ;;RESPIRATION;{973ED2C0-0625-7DF9-17DC-8FFF7E376F23}
"RTN","MDCPROTD",45,0)
 ;;TEMPERATURE;{0F33223E-DF2C-6B8B-5201-5E091C5F9065}
"RTN","MDCPROTD",46,0)
 ;;TONOMETRY;{C06989EF-4B0F-4941-B1A7-FA9D81A480FF}
"RTN","MDCPROTD",47,0)
 ;;VISION CORRECTED;{ED022AC1-EBE4-E708-684D-63D00628A94C}
"RTN","MDCPROTD",48,0)
 ;;VISION UNCORRECTED;{BEA5E565-D728-F5B3-0A3A-0528C42A45C4}
"RTN","MDCPROTD",49,0)
 ;;WEIGHT;{CD2D8263-6B71-0E1C-0AFE-87B4B2C12632}
"RTN","MDPOST38")
0^^B2283064
"RTN","MDPOST38",1,0)
MDPOST38 ;HINES OIFO/MKB - Post Installation Tasks;02 Mar 2008 ; 12/12/13 8:52pm
"RTN","MDPOST38",2,0)
 ;;1.0;CLINICAL PROCEDURES;**38**;Apr 01, 2004;Build 274
"RTN","MDPOST38",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","MDPOST38",4,0)
 ;
"RTN","MDPOST38",5,0)
 ; External References -
"RTN","MDPOST38",6,0)
 ;  CREIXN^DDMOD - IA # 2916
"RTN","MDPOST38",7,0)
 ;
"RTN","MDPOST38",8,0)
EN ; -- create ASTATUS index on OBS file #704.117
"RTN","MDPOST38",9,0)
 Q:$O(^DD("IX","BB",704.117,"ASTATUS",0))  ;exists
"RTN","MDPOST38",10,0)
 N VPRX,VPRY
"RTN","MDPOST38",11,0)
 S VPRX("FILE")=704.117,VPRX("NAME")="ASTATUS"
"RTN","MDPOST38",12,0)
 S VPRX("TYPE")="MU",VPRX("USE")="A"
"RTN","MDPOST38",13,0)
 S VPRX("EXECUTION")="F",VPRX("ACTIVITY")=""
"RTN","MDPOST38",14,0)
 S VPRX("SHORT DESCR")="Used to trigger MD OBSERVATION UPDATE protocol"
"RTN","MDPOST38",15,0)
 S VPRX("DESCR",1)="This index invokes the MD OBSERVATION UPDATE protocol when the"
"RTN","MDPOST38",16,0)
 S VPRX("DESCR",2)="status of OBS data is changed to or from verified."
"RTN","MDPOST38",17,0)
 S VPRX("DESCR",3)="No actual cross-reference nodes are set or killed."
"RTN","MDPOST38",18,0)
 S VPRX("SET")="D:((X1=""1"")!(X2=""1"")) PROT^MDCPROTD Q"
"RTN","MDPOST38",19,0)
 S VPRX("KILL")="Q",VPRX("WHOLE KILL")="Q"
"RTN","MDPOST38",20,0)
 S VPRX("VAL",1)=.09            ;Status
"RTN","MDPOST38",21,0)
 D CREIXN^DDMOD(.VPRX,"",.VPRY) ;VPRY=ien^name of index
"RTN","MDPOST38",22,0)
 Q
"VER")
8.0^22.0
**INSTALL NAME**
OR*3.0*390
"BLD",9064,0)
OR*3.0*390^ORDER ENTRY/RESULTS REPORTING^0^3150414^y
"BLD",9064,4,0)
^9.64PA^^0
"BLD",9064,6.3)
412
"BLD",9064,"INIT")

"BLD",9064,"KRN",0)
^9.67PA^779.2^20
"BLD",9064,"KRN",.4,0)
.4
"BLD",9064,"KRN",.401,0)
.401
"BLD",9064,"KRN",.402,0)
.402
"BLD",9064,"KRN",.403,0)
.403
"BLD",9064,"KRN",.5,0)
.5
"BLD",9064,"KRN",.84,0)
.84
"BLD",9064,"KRN",3.6,0)
3.6
"BLD",9064,"KRN",3.8,0)
3.8
"BLD",9064,"KRN",9.2,0)
9.2
"BLD",9064,"KRN",9.8,0)
9.8
"BLD",9064,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",9064,"KRN",9.8,"NM",1,0)
ORCACT1^^0^B49643037
"BLD",9064,"KRN",9.8,"NM",2,0)
ORCSEND^^0^B65938879
"BLD",9064,"KRN",9.8,"NM",3,0)
ORMBLDOR^^0^B5650360
"BLD",9064,"KRN",9.8,"NM",4,0)
ORWDXA^^0^B83177974
"BLD",9064,"KRN",9.8,"NM","B","ORCACT1",1)

"BLD",9064,"KRN",9.8,"NM","B","ORCSEND",2)

"BLD",9064,"KRN",9.8,"NM","B","ORMBLDOR",3)

"BLD",9064,"KRN",9.8,"NM","B","ORWDXA",4)

"BLD",9064,"KRN",19,0)
19
"BLD",9064,"KRN",19.1,0)
19.1
"BLD",9064,"KRN",101,0)
101
"BLD",9064,"KRN",101,"NM",0)
^9.68A^1^1
"BLD",9064,"KRN",101,"NM",1,0)
OR EVSEND VPR^^0
"BLD",9064,"KRN",101,"NM","B","OR EVSEND VPR",1)

"BLD",9064,"KRN",409.61,0)
409.61
"BLD",9064,"KRN",771,0)
771
"BLD",9064,"KRN",779.2,0)
779.2
"BLD",9064,"KRN",870,0)
870
"BLD",9064,"KRN",8989.51,0)
8989.51
"BLD",9064,"KRN",8989.52,0)
8989.52
"BLD",9064,"KRN",8994,0)
8994
"BLD",9064,"KRN","B",.4,.4)

"BLD",9064,"KRN","B",.401,.401)

"BLD",9064,"KRN","B",.402,.402)

"BLD",9064,"KRN","B",.403,.403)

"BLD",9064,"KRN","B",.5,.5)

"BLD",9064,"KRN","B",.84,.84)

"BLD",9064,"KRN","B",3.6,3.6)

"BLD",9064,"KRN","B",3.8,3.8)

"BLD",9064,"KRN","B",9.2,9.2)

"BLD",9064,"KRN","B",9.8,9.8)

"BLD",9064,"KRN","B",19,19)

"BLD",9064,"KRN","B",19.1,19.1)

"BLD",9064,"KRN","B",101,101)

"BLD",9064,"KRN","B",409.61,409.61)

"BLD",9064,"KRN","B",771,771)

"BLD",9064,"KRN","B",779.2,779.2)

"BLD",9064,"KRN","B",870,870)

"BLD",9064,"KRN","B",8989.51,8989.51)

"BLD",9064,"KRN","B",8989.52,8989.52)

"BLD",9064,"KRN","B",8994,8994)

"BLD",9064,"QUES",0)
^9.62^^
"BLD",9064,"REQB",0)
^9.611^4^4
"BLD",9064,"REQB",1,0)
OR*3.0*97^2
"BLD",9064,"REQB",2,0)
OR*3.0*284^2
"BLD",9064,"REQB",3,0)
OR*3.0*296^2
"BLD",9064,"REQB",4,0)
OR*3.0*306^2
"BLD",9064,"REQB","B","OR*3.0*284",2)

"BLD",9064,"REQB","B","OR*3.0*296",3)

"BLD",9064,"REQB","B","OR*3.0*306",4)

"BLD",9064,"REQB","B","OR*3.0*97",1)

"KRN",101,6089,-1)
0^1
"KRN",101,6089,0)
OR EVSEND VPR^OE/RR => VPR MESSAGE EVENT^^X^^^^^^^^
"KRN",101,6089,10,0)
^101.01PA^11^1
"KRN",101,6089,99)
63656,23225
"MBREQ")
1
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"PKG",170,-1)
1^1
"PKG",170,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",170,22,0)
^9.49I^1^1
"PKG",170,22,1,0)
3.0^2971217^2980917^11712
"PKG",170,22,1,"PAH",1,0)
390^3150414^1
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","ORCACT1")
0^1^B49643037
"RTN","ORCACT1",1,0)
ORCACT1 ;SLC/MKB-Act on orders cont ;7/29/97  08:26
"RTN","ORCACT1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**7,27,56,48,86,92,116,149,215,284,390**;Dec 17, 1997;Build 412
"RTN","ORCACT1",3,0)
 ;
"RTN","ORCACT1",4,0)
FLAG ; -- flag orders
"RTN","ORCACT1",5,0)
 D EN("FL") Q
"RTN","ORCACT1",6,0)
 ;
"RTN","ORCACT1",7,0)
UNFLAG ; -- unflag orders
"RTN","ORCACT1",8,0)
 D EN("UF") Q
"RTN","ORCACT1",9,0)
 ;
"RTN","ORCACT1",10,0)
COMMENT ; -- add ward comments to orders
"RTN","ORCACT1",11,0)
 D EN("CM") Q
"RTN","ORCACT1",12,0)
 ;
"RTN","ORCACT1",13,0)
ALERT ; -- alert provider when results available
"RTN","ORCACT1",14,0)
 D EN("AL") Q
"RTN","ORCACT1",15,0)
 ;
"RTN","ORCACT1",16,0)
UNHOLD ; -- release hold on orders - no longer in use
"RTN","ORCACT1",17,0)
 Q  ; see UNHOLD^ORCACT instead
"RTN","ORCACT1",18,0)
 ;
"RTN","ORCACT1",19,0)
EN(ORACT) ; -- Actions that don't create orders
"RTN","ORCACT1",20,0)
 ;    ORNMBR = #,#,...,# of selected orders
"RTN","ORCACT1",21,0)
 ;    ORACT  = action to be taken
"RTN","ORCACT1",22,0)
 ;
"RTN","ORCACT1",23,0)
 ;    OREBUILD defined on return if Orders tab needs to be rebuilt
"RTN","ORCACT1",24,0)
 ;
"RTN","ORCACT1",25,0)
 N ORLK,ORI,NMBR,IDX,ORIFN,ORDITM,ORERR,ORQUIT
"RTN","ORCACT1",26,0)
 I '$G(ORNMBR) S ORNMBR=$$ORDERS^ORCHART("") Q:'ORNMBR
"RTN","ORCACT1",27,0)
 D FREEZE^ORCMENU S VALMBCK="R" K OREBUILD
"RTN","ORCACT1",28,0)
 F ORI=1:1:$L(ORNMBR,",") S NMBR=$P(ORNMBR,",",ORI) D:NMBR  Q:$D(ORQUIT)
"RTN","ORCACT1",29,0)
 . S IDX=$G(^TMP("OR",$J,ORTAB,"IDX",NMBR)),ORIFN=$P(IDX,U)
"RTN","ORCACT1",30,0)
 . Q:'ORIFN  S:'$P(ORIFN,";",2) ORIFN=+ORIFN_";1"
"RTN","ORCACT1",31,0)
 . I '$D(^OR(100,+ORIFN,0)) W !,"This order has been deleted!" H 1 Q
"RTN","ORCACT1",32,0)
 . S ORDITM=$$ORDITEM^ORCACT(ORIFN) D SUBHDR^ORCACT(ORDITM)
"RTN","ORCACT1",33,0)
 . I '$$VALID^ORCACT0(ORIFN,ORACT,.ORERR) W !,ORERR H 1 Q
"RTN","ORCACT1",34,0)
 . S ORLK=$$LOCK1^ORX2(+ORIFN) I 'ORLK W !,$P(ORLK,U,2) H 1 Q
"RTN","ORCACT1",35,0)
 . D @ORACT,UNLK1^ORX2(+ORIFN)
"RTN","ORCACT1",36,0)
ENQ Q
"RTN","ORCACT1",37,0)
 ;
"RTN","ORCACT1",38,0)
FL ; -- Flag order ORIFN
"RTN","ORCACT1",39,0)
 D EN^ORCFLAG
"RTN","ORCACT1",40,0)
 Q
"RTN","ORCACT1",41,0)
 ;
"RTN","ORCACT1",42,0)
UF ; -- Unflag order ORIFN
"RTN","ORCACT1",43,0)
 D UN^ORCFLAG
"RTN","ORCACT1",44,0)
 Q
"RTN","ORCACT1",45,0)
 ;
"RTN","ORCACT1",46,0)
CM ; -- Ward Comments on order ORIFN
"RTN","ORCACT1",47,0)
 N DIC,DWPK,DIWEPSE,DIWESUB,DDWRW
"RTN","ORCACT1",48,0)
 S DIC="^OR(100,"_+ORIFN_",8,"_+$P(ORIFN,";",2)_",5,",(DWPK,DIWEPSE)=1
"RTN","ORCACT1",49,0)
 S DIWESUB=ORDITM,DDWRW="B" ;go to bottom of text
"RTN","ORCACT1",50,0)
 D EN^DIWE
"RTN","ORCACT1",51,0)
 Q
"RTN","ORCACT1",52,0)
 ;
"RTN","ORCACT1",53,0)
AL ; -- Alert when results are available for order ORIFN
"RTN","ORCACT1",54,0)
 S $P(^OR(100,+ORIFN,3),U,10)=1
"RTN","ORCACT1",55,0)
 W !?10,"... done." H 1
"RTN","ORCACT1",56,0)
 Q
"RTN","ORCACT1",57,0)
 ;
"RTN","ORCACT1",58,0)
RL ; -- Release hold on order ORIFN [No longer used]
"RTN","ORCACT1",59,0)
 D EN^ORCSEND(+ORIFN,ORACT,3,1,,,.ORERR)
"RTN","ORCACT1",60,0)
 W !,"... order "_$S($G(ORERR):"not ",1:"")_"released from hold."
"RTN","ORCACT1",61,0)
 W:$L($P($G(ORERR),U,2)) !,"  >> "_$P(ORERR,U,2) H 1
"RTN","ORCACT1",62,0)
 S OREBUILD=1 ; print?
"RTN","ORCACT1",63,0)
 Q
"RTN","ORCACT1",64,0)
 ;
"RTN","ORCACT1",65,0)
VERIFY(ORVER) ; -- Verify orders
"RTN","ORCACT1",66,0)
 N ORLK,ORI,NMBR,IDX,ORIFN,ORDITM,ORES,ORERR,ORSIG,OROLDSTS,ORNEW,ORWAIT
"RTN","ORCACT1",67,0)
 I "^"[$G(ORVER) W $C(7),!!,"You must be a nurse or clerk to verify these orders!" S VALMBCK="" H 2 Q
"RTN","ORCACT1",68,0)
 I '$G(ORNMBR) S ORNMBR=$$ORDERS^ORCHART("") Q:'ORNMBR
"RTN","ORCACT1",69,0)
 D FREEZE^ORCMENU S VALMBCK="R" K OREBUILD
"RTN","ORCACT1",70,0)
 F ORI=1:1:$L(ORNMBR,",") S NMBR=$P(ORNMBR,",",ORI) D:NMBR  Q:$D(ORQUIT)
"RTN","ORCACT1",71,0)
 . S IDX=$G(^TMP("OR",$J,ORTAB,"IDX",NMBR)),ORIFN=$P(IDX,U)
"RTN","ORCACT1",72,0)
 . Q:'ORIFN  S:'$P(ORIFN,";",2) ORIFN=+ORIFN_";1" Q:$D(ORES(ORIFN))
"RTN","ORCACT1",73,0)
 . I '$$VALID^ORCACT0(ORIFN,"VR",.ORERR) W !!,$$ORDITEM^ORCACT(ORIFN)_" invalid.",!,"  >> "_ORERR H 1 Q
"RTN","ORCACT1",74,0)
 . S ORLK=$$LOCK1^ORX2(+ORIFN) I 'ORLK W !!,$$ORDITEM^ORCACT(ORIFN)_" invalid.",!,"  >> "_$P(ORLK,U,2) H 1 Q
"RTN","ORCACT1",75,0)
 . S ORES(ORIFN)="" D REPLCD
"RTN","ORCACT1",76,0)
VR1 Q:'$O(ORES(0))  D COMPLX S ORSIG=$S($$ESIG^ORCSIGN:1,1:0)
"RTN","ORCACT1",77,0)
 I 'ORSIG W !,"Nothing verified!" D UNLOCK H 1 Q
"RTN","ORCACT1",78,0)
 W !!,"Verifying orders ..."
"RTN","ORCACT1",79,0)
 S ORIFN=0 F  S ORIFN=$O(ORES(ORIFN)) Q:ORIFN'>0  D
"RTN","ORCACT1",80,0)
 . S OROLDSTS=+$P($G(^OR(100,+ORIFN,3)),U,3)
"RTN","ORCACT1",81,0)
 . D EN^ORCSEND(ORIFN,"VR","","",,,.ORERR),UNLK1^ORX2(+ORIFN)
"RTN","ORCACT1",82,0)
 . I $G(ORERR) D  Q
"RTN","ORCACT1",83,0)
 . . W !,$$ORDITEM^ORCACT(ORIFN)_" not verified."
"RTN","ORCACT1",84,0)
 . . W:$L($P($G(ORERR),U,2)) !,"  >> "_$P(ORERR,U,2) H 1
"RTN","ORCACT1",85,0)
 . S ORNEW=+$P($G(^OR(100,+ORIFN,3)),U,3) I ORNEW'=OROLDSTS W !,$$ORDITEM^ORCACT(ORIFN)_" is now "_$$STS(ORNEW)_"." S ORWAIT=1
"RTN","ORCACT1",86,0)
 S OREBUILD=1 D:'$D(XQAID) CKALERT I $G(ORWAIT) H 2
"RTN","ORCACT1",87,0)
VRQ Q
"RTN","ORCACT1",88,0)
 ;
"RTN","ORCACT1",89,0)
STS(X) ; -- Return name of status X
"RTN","ORCACT1",90,0)
 N Y S Y=$P($G(^ORD(100.01,+$G(X),0)),U)
"RTN","ORCACT1",91,0)
 Q Y
"RTN","ORCACT1",92,0)
 ;
"RTN","ORCACT1",93,0)
REPLCD ; -- Ck for unverified replaced orders for ORIFN, add to ORES(order#)
"RTN","ORCACT1",94,0)
 ;    [Expects ORVER; also called from VERIFY^ORWDXA,VERIFY^ORRCOR]
"RTN","ORCACT1",95,0)
 N OR3,ORIG,ORFLD,ORDA,ORI,ORLK
"RTN","ORCACT1",96,0)
 S ORFLD=$S($G(ORVER)="N":8,$G(ORVER)="R":18,1:10),ORDA=+$P(ORIFN,";",2)
"RTN","ORCACT1",97,0)
 I ORDA>1 D  Q  ;ck for prior unverified actions
"RTN","ORCACT1",98,0)
 . ;Q:$P($G(^OR(100,+ORIFN,8,ORDA,0)),U,2)'="XX"
"RTN","ORCACT1",99,0)
 . S ORI=0 F  S ORI=$O(^OR(100,+ORIFN,8,ORI)) Q:ORI<1  Q:ORI'<ORDA  D
"RTN","ORCACT1",100,0)
 .. Q:$P($G(^OR(100,+ORIFN,8,ORI,0)),U,ORFLD)  ;already verified
"RTN","ORCACT1",101,0)
 .. S ORLK=$$LOCK1^ORX2(+ORIFN) Q:'ORLK
"RTN","ORCACT1",102,0)
 .. S ORES(+ORIFN_";"_ORI)=""
"RTN","ORCACT1",103,0)
 S OR3=$G(^OR(100,+ORIFN,3)) Q:$P(OR3,U,11)'=1
"RTN","ORCACT1",104,0)
 S ORIG=+$P(OR3,U,5) Q:'ORIG  Q:$P($G(^OR(100,ORIG,3)),U,3)'=12
"RTN","ORCACT1",105,0)
 S ORDA=0 F  S ORDA=$O(^OR(100,ORIG,8,ORDA)) Q:ORDA'>0  I '$P($G(^(ORDA,0)),U,ORFLD) D
"RTN","ORCACT1",106,0)
 . S ORLK=$$LOCK1^ORX2(ORIG) Q:'ORLK
"RTN","ORCACT1",107,0)
 . S ORES(ORIG_";"_ORDA)=""
"RTN","ORCACT1",108,0)
 Q
"RTN","ORCACT1",109,0)
 ;
"RTN","ORCACT1",110,0)
COMPLX ; -- Ck for other child orders to be verified at same time
"RTN","ORCACT1",111,0)
 N IFN,DAD,CHLD,ALL,P,X,I
"RTN","ORCACT1",112,0)
 S P=$S(ORVER="N":9,ORVER="C":11,ORVER="R":19,1:0) Q:P<1
"RTN","ORCACT1",113,0)
 S IFN=0 F  S IFN=$O(ORES(IFN)) Q:IFN<1  D
"RTN","ORCACT1",114,0)
 . S X=+$P($G(^OR(100,+IFN,0)),U,14) Q:$$NMSP^ORCD(X)'["PS"
"RTN","ORCACT1",115,0)
 . S X=$P($G(^OR(100,+IFN,8,+$P(IFN,";",2),0)),U,2) Q:X'="NW"&(X'="XX")
"RTN","ORCACT1",116,0)
 . I $P($G(^OR(100,+IFN,3)),U,9) S DAD(+$P(^(3),U,9))=""
"RTN","ORCACT1",117,0)
 Q:'$O(DAD(0))  S IFN=0 F  S IFN=+$O(DAD(IFN)) Q:IFN<1  D
"RTN","ORCACT1",118,0)
 . S CHLD=0,ALL=1
"RTN","ORCACT1",119,0)
 . F  S CHLD=+$O(^OR(100,IFN,2,CHLD)) Q:CHLD<1  F X="NW","XX" D
"RTN","ORCACT1",120,0)
 .. S I=+$O(^OR(100,CHLD,8,"C",X,0)) Q:I<1
"RTN","ORCACT1",121,0)
 .. Q:$P($G(^OR(100,CHLD,8,I,0)),U,P)  Q:$D(ORES(CHLD_";"_I))
"RTN","ORCACT1",122,0)
 .. S ORES(CHLD_";"_I)="",ALL=0
"RTN","ORCACT1",123,0)
 . Q:ALL  S X=$$ORDITEM^ORCACT(IFN) D SUBHDR^ORCACT(X)
"RTN","ORCACT1",124,0)
 . W !,"All doses of this complex order must be verified together;"
"RTN","ORCACT1",125,0)
 . W !,"adding remaining doses to signature list..."
"RTN","ORCACT1",126,0)
 Q
"RTN","ORCACT1",127,0)
 ;
"RTN","ORCACT1",128,0)
CKALERT ; -- Ck if Unverified Orders alerts can be deleted
"RTN","ORCACT1",129,0)
 N ORNOW,ORBEG,ORLIST,ORALL,ORMEDS S ORNOW=$$NOW^XLFDT
"RTN","ORCACT1",130,0)
 S:'$G(ORWARD) ORBEG=$$FMADD^XLFDT(ORNOW,"-30") I $G(ORWARD) D
"RTN","ORCACT1",131,0)
 . N DFN,VAIN,VAERR S DFN=+ORVP D INP^VADPT
"RTN","ORCACT1",132,0)
 . S ORBEG=$S($G(VAIN(7)):$P(VAIN(7),U),1:$$FMADD^XLFDT(ORNOW,-30))
"RTN","ORCACT1",133,0)
 D EN^ORQ1(ORVP,,9,,ORBEG,ORNOW) ;see if any unverified orders remain
"RTN","ORCACT1",134,0)
 I $G(ORLIST),$G(^TMP("ORR",$J,ORLIST,"TOT")) D  ;see if any are meds
"RTN","ORCACT1",135,0)
 . N ORRX,ORGRP,I,IFN,DG S ORALL=1
"RTN","ORCACT1",136,0)
 . S ORRX=+$O(^ORD(100.98,"B","RX",0)) D GRP^ORQ1(ORRX)
"RTN","ORCACT1",137,0)
 . S I=0 F  S I=$O(^TMP("ORR",$J,ORLIST,I)) Q:I'>0  S IFN=+^(I),DG=+$P($G(^OR(100,IFN,0)),U,11) I $D(ORGRP(DG)) S ORMEDS=1 Q
"RTN","ORCACT1",138,0)
 D:'$G(ORALL) DELALRT("UNVERIFIED ORDER")
"RTN","ORCACT1",139,0)
 D:'$G(ORMEDS) DELALRT("UNVERIFIED MEDICATION ORDER")
"RTN","ORCACT1",140,0)
 Q
"RTN","ORCACT1",141,0)
 ;
"RTN","ORCACT1",142,0)
DELALRT(X) ; -- delete alert X
"RTN","ORCACT1",143,0)
 N ORNIFN,XQAKILL,XQAID
"RTN","ORCACT1",144,0)
 S ORNIFN=+$O(^ORD(100.9,"B",X,0)) Q:ORNIFN'>0
"RTN","ORCACT1",145,0)
 S XQAKILL=$$XQAKILL^ORB3F1(ORNIFN)
"RTN","ORCACT1",146,0)
 S XQAID=$P($G(^ORD(100.9,ORNIFN,0)),U,2)_","_+ORVP_","_ORNIFN
"RTN","ORCACT1",147,0)
 D DELETEA^XQALERT
"RTN","ORCACT1",148,0)
 Q
"RTN","ORCACT1",149,0)
 ;
"RTN","ORCACT1",150,0)
UNLOCK ; -- Unlock orders in ORES(ORIFN) [from VR1]
"RTN","ORCACT1",151,0)
 F  S ORIFN=$O(ORES(ORIFN)) Q:ORIFN'>0  D UNLK1^ORX2(+ORIFN)
"RTN","ORCACT1",152,0)
 Q
"RTN","ORCACT1",153,0)
 ;
"RTN","ORCACT1",154,0)
SIGNREQD(IFN) ; -- Returns 2, 1, or 0, if order/actions need ES
"RTN","ORCACT1",155,0)
 Q +$P($G(^OR(100,IFN,0)),U,16)
"RTN","ORCACT1",156,0)
 ;
"RTN","ORCACT1",157,0)
SIGN ; -- Sign orders [no longer used]
"RTN","ORCACT1",158,0)
 D EN^ORCSIGN
"RTN","ORCACT1",159,0)
 Q
"RTN","ORCACT1",160,0)
 ;
"RTN","ORCACT1",161,0)
COMPLETE ; -- complete orders
"RTN","ORCACT1",162,0)
 N ORLK,ORI,NMBR,IDX,ORIFN,ORDITM,ORES,ORERR,ORSIG,ORSTOP
"RTN","ORCACT1",163,0)
 I '$G(ORNMBR) S ORNMBR=$$ORDERS^ORCHART("complete") Q:'ORNMBR
"RTN","ORCACT1",164,0)
 D FREEZE^ORCMENU S VALMBCK="R" K OREBUILD
"RTN","ORCACT1",165,0)
 F ORI=1:1:$L(ORNMBR) S NMBR=$P(ORNMBR,",",ORI) D:NMBR  Q:$D(ORQUIT)
"RTN","ORCACT1",166,0)
 . S IDX=$G(^TMP("OR",$J,ORTAB,"IDX",NMBR)),ORIFN=$P(IDX,U)
"RTN","ORCACT1",167,0)
 . Q:'ORIFN  S:'$P(ORIFN,";",2) ORIFN=+ORIFN_";1"
"RTN","ORCACT1",168,0)
 . I '$$VALID^ORCACT0(ORIFN,"CP",.ORERR) W !!,$$ORDITEM^ORCACT(ORIFN)_" invalid.",!,"  >> "_ORERR H 1 Q
"RTN","ORCACT1",169,0)
 . S ORLK=$$LOCK1^ORX2(+ORIFN) I 'ORLK W !!,$$ORDITEM^ORCACT(ORIFN)_" invalid.",!,"  >> "_$P(ORLK,U,2) H 1 Q
"RTN","ORCACT1",170,0)
 . S ORES(ORIFN)=""
"RTN","ORCACT1",171,0)
CP1 Q:'$O(ORES(0))  S ORSIG=$S($$ESIG^ORCSIGN:1,1:0)
"RTN","ORCACT1",172,0)
 I 'ORSIG W !,"Nothing completed!" D UNLOCK H 1 Q
"RTN","ORCACT1",173,0)
 W !!,"Completing orders ..." S ORSTOP=+$E($$NOW^XLFDT,1,12),ORIFN=0
"RTN","ORCACT1",174,0)
 F  S ORIFN=$O(ORES(ORIFN)) Q:ORIFN'>0  D
"RTN","ORCACT1",175,0)
 . D COMP^ORCSAVE2(ORIFN,DUZ,ORSTOP),UNLK1^ORX2(+ORIFN)
"RTN","ORCACT1",176,0)
 . D COMP^ORMBLDOR(ORIFN)
"RTN","ORCACT1",177,0)
 S OREBUILD=1
"RTN","ORCACT1",178,0)
CPQ Q
"RTN","ORCSEND")
0^2^B65938879
"RTN","ORCSEND",1,0)
ORCSEND ;SLC/MKB-Release orders ; 11/8/2006
"RTN","ORCSEND",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**4,27,45,79,92,141,165,195,228,243,303,296,390**;Dec 17, 1997;Build 412
"RTN","ORCSEND",3,0)
 ;
"RTN","ORCSEND",4,0)
EN(ORIFN,ACTION,SIGSTS,RELSTS,NATURE,REASON,ORERR) ; -- Release [actions on] orders
"RTN","ORCSEND",5,0)
 N ORDA,ORNOW,SIGNREQD,SIGNED,SIGNER
"RTN","ORCSEND",6,0)
 S SIGNREQD=+$P($G(^OR(100,+ORIFN,0)),U,16),ORERR=""
"RTN","ORCSEND",7,0)
 S SIGNED=$S(SIGSTS=2:0,1:1),SIGNER=$S(SIGSTS=1:DUZ,SIGSTS=7:DUZ,1:"")
"RTN","ORCSEND",8,0)
 S ORDA=+$P(ORIFN,";",2),ORIFN=+ORIFN,ORNOW=+$E($$NOW^XLFDT,1,12)
"RTN","ORCSEND",9,0)
 S:"ES"[$G(ACTION) ACTION=$P($G(^OR(100,ORIFN,8,ORDA,0)),U,2)
"RTN","ORCSEND",10,0)
 I SIGNREQD,ORDA,"^NW^RW^XX^RN^DC^HD^RL^"[(U_ACTION_U) D  ; sign/alert
"RTN","ORCSEND",11,0)
 . I 'SIGNED D NOTIF^ORCSIGN Q
"RTN","ORCSEND",12,0)
 . D:SIGSTS'="" SIGN^ORCSAVE2(ORIFN,SIGNER,ORNOW,SIGSTS,ORDA)
"RTN","ORCSEND",13,0)
 . D:SIGSTS=4 CHART^ORCSIGN ; not used anymore
"RTN","ORCSEND",14,0)
 I '$L(ACTION) S ORERR="1^Invalid order action" Q
"RTN","ORCSEND",15,0)
 I $$READY(ORIFN,ORDA) D:$L($T(@ACTION)) @ACTION I 'ORERR,ACTION="NW" D
"RTN","ORCSEND",16,0)
 . N OREVT S OREVT=+$P($G(^OR(100,ORIFN,0)),U,17) Q:OREVT<1
"RTN","ORCSEND",17,0)
 . I '$$EVTORDER^OREVNTX(ORIFN) D SAVE^ORMEVNT1(ORIFN,OREVT,2,"ES")
"RTN","ORCSEND",18,0)
 ; If order originated from the back door, send Dx and TxF back to ancil.
"RTN","ORCSEND",19,0)
 I SIGNED,$P($G(^OR(100,+ORIFN,3)),U,11)="P" D BDOEDIT^ORWDBA7
"RTN","ORCSEND",20,0)
 Q
"RTN","ORCSEND",21,0)
 ;
"RTN","ORCSEND",22,0)
EN1(ORDER,ORERR) ; -- Delayed Release [from RELEASE^ORMEVNT]
"RTN","ORCSEND",23,0)
 ;
"RTN","ORCSEND",24,0)
 Q:$P($G(^OR(100,+ORDER,3)),U,3)'=10
"RTN","ORCSEND",25,0)
 N ORPKG,ORA0,ORNOW,ORIFN,ORDA,ORNP,ORNATR,ORQUIT,ORDUZ,SIGSTS,RELSTS
"RTN","ORCSEND",26,0)
 S ORPKG=$P($G(^OR(100,+ORDER,0)),U,14),ORA0=$G(^(8,1,0))
"RTN","ORCSEND",27,0)
 S ORNOW=+$E($$NOW^XLFDT,1,12),ORIFN=+ORDER,ORDA=1,ORNP=$P(ORA0,U,3)
"RTN","ORCSEND",28,0)
 S SIGSTS=$P(ORA0,U,4),ORNATR=$P($G(^ORD(100.02,+$P(ORA0,U,12),0)),U,2)
"RTN","ORCSEND",29,0)
 S RELSTS=$S(SIGSTS'=2:1,"^V^P^"[(U_ORNATR_U):1,1:0)
"RTN","ORCSEND",30,0)
 I RELSTS D
"RTN","ORCSEND",31,0)
 . D STARTDT^ORCSAVE2(ORIFN),PKGSTUFF^ORCSEND1(ORPKG) Q:$G(ORQUIT)
"RTN","ORCSEND",32,0)
 . S ORDUZ=$S(SIGSTS=0:$P(ORA0,U,7),SIGSTS=1:$P(ORA0,U,5),SIGSTS=2:$P(ORA0,U,17),SIGSTS=3:$P(ORA0,U,13),1:DUZ)
"RTN","ORCSEND",33,0)
 . D EDO1^ORWPFSS1  ;PFSS Event Delayed Orders
"RTN","ORCSEND",34,0)
 . D RELEASE^ORCSAVE2(ORIFN,ORDA,ORNOW,ORDUZ),NEW^ORMBLD(ORIFN)
"RTN","ORCSEND",35,0)
 . I "^10^13^"[(U_$P($G(^OR(100,ORIFN,3)),U,3)_U) S ORERR=1 ;error
"RTN","ORCSEND",36,0)
 I 'RELSTS!$G(ORERR),$P($G(^OR(100,ORIFN,3)),U,3)=10 D STATUS^ORCSAVE2(ORIFN,11) S $P(^OR(100,ORIFN,8,1,0),U,15)=11
"RTN","ORCSEND",37,0)
 Q
"RTN","ORCSEND",38,0)
 ;
"RTN","ORCSEND",39,0)
EN2(ORIFN,SIGSTS,NATURE,ORERR) ; -- Manual Release [from OREVNT1,SENDED^ORWDX]
"RTN","ORCSEND",40,0)
 N ORDA,ORNOW,OREVT,ORA0,ORNP,SIGNREQD,SIGNED,RELSTS
"RTN","ORCSEND",41,0)
 S ORDA=+$P(ORIFN,";",2),ORIFN=+ORIFN S:ORDA<1 ORDA=1
"RTN","ORCSEND",42,0)
 S OREVT=+$P($G(^OR(100,ORIFN,0)),U,17),ORA0=$G(^(8,ORDA,0))
"RTN","ORCSEND",43,0)
 S ORNP=$P(ORA0,U,3),SIGNREQD=($P(ORA0,U,4)'=3),(SIGNED,RELSTS)=1
"RTN","ORCSEND",44,0)
 S ORNOW=+$E($$NOW^XLFDT,1,12),ORERR=""
"RTN","ORCSEND",45,0)
 I $P(ORA0,U,4)=2 D  ;needs ES
"RTN","ORCSEND",46,0)
 . N SIGNER S SIGNER=$S(SIGSTS=1:DUZ,1:"")
"RTN","ORCSEND",47,0)
 . I SIGSTS=2 D NOTIF^ORCSIGN S SIGNED=0 Q  ;still unsigned
"RTN","ORCSEND",48,0)
 . D:SIGSTS'="" SIGN^ORCSAVE2(ORIFN,SIGNER,ORNOW,SIGSTS,ORDA)
"RTN","ORCSEND",49,0)
 D EDO2^ORWPFSS1  ;PFSS Event Delayed Orders
"RTN","ORCSEND",50,0)
 D NW I 'ORERR D SAVE^ORMEVNT1(+ORIFN,OREVT,2,"MN")
"RTN","ORCSEND",51,0)
 Q
"RTN","ORCSEND",52,0)
 ;
"RTN","ORCSEND",53,0)
NW ; -- New order ORIFN
"RTN","ORCSEND",54,0)
RW ; -- Rewritten order ORIFN
"RTN","ORCSEND",55,0)
XX ; -- Changed order ORIFN
"RTN","ORCSEND",56,0)
RN ; -- Renewed order ORIFN
"RTN","ORCSEND",57,0)
 N ORQUIT,STS,TYPE,OR0,OR3,CODE,ORIG,ORSAVE
"RTN","ORCSEND",58,0)
 N IVDIEN,IVPKGM
"RTN","ORCSEND",59,0)
 S IVPKGM=0
"RTN","ORCSEND",60,0)
 S IVDIEN=$O(^ORD(101.41,"B","PSJI OR PAT FLUID OE",""))
"RTN","ORCSEND",61,0)
 I SIGNREQD,'SIGNED,'RELSTS S ORERR=$$NEEDSIG,OREBUILD=1 Q
"RTN","ORCSEND",62,0)
 S:'ORDA ORDA=1 S ORSAVE=ORIFN
"RTN","ORCSEND",63,0)
 S OR0=$G(^OR(100,ORIFN,0)),OR3=$G(^(3)) D STARTDT^ORCSAVE2(ORIFN)
"RTN","ORCSEND",64,0)
 S TYPE=$P(OR3,U,11),ORIG=+$P(OR3,U,5),CODE="NW"
"RTN","ORCSEND",65,0)
 I TYPE=1,ORIG,$D(^OR(100,ORIG,4)) S CODE="XO",^OR(100,ORIG,6)=$O(^ORD(100.02,"C","C",0))_U_DUZ_U_ORNOW
"RTN","ORCSEND",66,0)
 I $$GET1^DIQ(9.4,+$P(OR0,U,14)_",",1)="PSJ" S IVPKGM=1
"RTN","ORCSEND",67,0)
 I IVPKGM=1,$P($P(OR0,U,5),";")=IVDIEN D PSJI^ORCSEND3 Q:$G(ORQUIT)
"RTN","ORCSEND",68,0)
 I IVPKGM=0!($P($P(OR0,U,5),";")'=IVDIEN) D PKGSTUFF^ORCSEND1(+$P(OR0,U,14)) Q:$G(ORQUIT)
"RTN","ORCSEND",69,0)
 D RELEASE^ORCSAVE2(ORIFN,ORDA,ORNOW,DUZ,$G(NATURE))
"RTN","ORCSEND",70,0)
 D NEW^ORMBLD(ORIFN,CODE) S ORIFN=ORSAVE,STS=$P($G(^OR(100,ORIFN,3)),U,3)
"RTN","ORCSEND",71,0)
 I (STS=1)!(STS=13) S ORERR="1^"_$$WHY(ORIFN,1) D:'SIGNED&SIGNREQD NOSIG K:ORIG ^OR(100,ORIG,6)
"RTN","ORCSEND",72,0)
 I STS=11 S ORERR="1^ERROR"
"RTN","ORCSEND",73,0)
 Q
"RTN","ORCSEND",74,0)
 ;
"RTN","ORCSEND",75,0)
DC ; -- DC order ORIFN
"RTN","ORCSEND",76,0)
 N PKG,CODE,ORCHLD,ORCHDA,STS,ORIDA,ORSAVE,OR3,OR6,DCNATURE
"RTN","ORCSEND",77,0)
 I '$G(REASON),$G(NATURE)="D" S REASON=+$O(^ORD(100.03,"C","ORDUP",0))
"RTN","ORCSEND",78,0)
 S:$G(REASON) $P(^OR(100,ORIFN,6),U,1,5)=$S($G(NATURE):NATURE,$L($G(NATURE)):$O(^ORD(100.02,"C",NATURE,0)),1:"")_"^^^"_+REASON_U_$P(^ORD(100.03,+REASON,0),U)
"RTN","ORCSEND",79,0)
 I SIGNREQD,'SIGNED,'RELSTS S ORERR=$$NEEDSIG Q
"RTN","ORCSEND",80,0)
 S $P(^OR(100,ORIFN,6),U,2,3)=$S($G(DGPMT):"",1:DUZ)_U_ORNOW,ORSAVE=ORIFN S:'$G(REASON) REASON=$P(^(6),U,4)
"RTN","ORCSEND",81,0)
 S STS=$P($G(^OR(100,ORIFN,3)),U,3),PKG=$P($G(^(0)),U,14),PKG=$$NMSP^ORCD(PKG),CODE=$S(PKG="LR":"CA",(PKG="PS")&(STS=5):"CA",(PKG="FH")&(STS=8):"CA",1:"DC")
"RTN","ORCSEND",82,0)
 D:ORDA RELEASE^ORCSAVE2(ORIFN,ORDA,ORNOW,DUZ,$G(NATURE))
"RTN","ORCSEND",83,0)
DC1 I $O(^OR(100,ORIFN,2,0)) D  G DC2 ; DC children
"RTN","ORCSEND",84,0)
 . S ORCHLD=0 F  S ORCHLD=$O(^OR(100,ORIFN,2,ORCHLD)) Q:ORCHLD'>0  I $$VALID^ORCACT0(ORCHLD,"DC") D  Q:$G(ORERR)
"RTN","ORCSEND",85,0)
 . . S ORCHDA=$S(ORDA:$$ACTION^ORCSAVE("DC",ORCHLD,ORNP),1:0)
"RTN","ORCSEND",86,0)
 . . D:ORCHDA SIGN^ORCSAVE2(ORCHLD,,,8,ORCHDA) ;Sig on Parent only
"RTN","ORCSEND",87,0)
 . . D MSG^ORMBLD((ORCHLD_";"_ORCHDA),CODE,$G(REASON))
"RTN","ORCSEND",88,0)
 . . I "^1^13^"'[(U_$P(^OR(100,ORCHLD,3),U,3)_U) S ORERR="1^"_$$WHY(ORCHLD,ORCHDA)
"RTN","ORCSEND",89,0)
 . ;D:'$G(ORERR) STATUS^ORCSAVE2(ORIFN,1)
"RTN","ORCSEND",90,0)
 . S:$G(ORERR) ^OR(100,ORIFN,8,ORDA,1)=$P(ORERR,U,2)
"RTN","ORCSEND",91,0)
 D MSG^ORMBLD((ORIFN_";"_ORDA),CODE,$G(REASON))
"RTN","ORCSEND",92,0)
DC2 S ORIFN=ORSAVE,OR3=$G(^OR(100,ORIFN,3)),STS=$P(OR3,U,3)
"RTN","ORCSEND",93,0)
 S OR6=$G(^OR(100,ORIFN,6))
"RTN","ORCSEND",94,0)
 I STS'=1,STS'=13,STS'=2 D  Q
"RTN","ORCSEND",95,0)
 . S ORERR="1^"_$S(ORDA:$$WHY(ORIFN,ORDA),1:"Unable to discontinue")
"RTN","ORCSEND",96,0)
 . I ORDA,'SIGNED&SIGNREQD D NOSIG ; sig no longer reqd
"RTN","ORCSEND",97,0)
 . K ^OR(100,ORIFN,6)
"RTN","ORCSEND",98,0)
 S DCNATURE=$S(+OR6:+OR6,1:$G(NATURE))
"RTN","ORCSEND",99,0)
 S $P(^OR(100,ORIFN,3),U,7)=$S('$$ACTV^ORX1($G(DCNATURE)):0,ORDA:ORDA,1:$P(OR3,U,7))
"RTN","ORCSEND",100,0)
 D CANCEL(ORIFN),SETALL^ORDD100(ORIFN)
"RTN","ORCSEND",101,0)
 I $P(OR3,U,11)=2 D  ; dc a renewal
"RTN","ORCSEND",102,0)
 . N ORIG,ORIG3,NATR S ORIG=$P(OR3,U,5),ORIG3=$G(^OR(100,ORIG,3)) Q:'ORIG
"RTN","ORCSEND",103,0)
 . ;I CODE="CA",+$P(OR6,U,9)'>0 S $P(^OR(100,ORIG,3),U,6)="" Q  ;pend - remove fwd ptr
"RTN","ORCSEND",104,0)
 . I +$P(OR6,U,9)'>0 S $P(^OR(100,ORIG,3),U,6)="" Q  ;pend - remove fwd ptr
"RTN","ORCSEND",105,0)
 . Q:"^1^7^12^13^"[(U_$P(ORIG3,U,3)_U)  S NATR=$O(^ORD(100.02,"C","A",0))
"RTN","ORCSEND",106,0)
 . S ^OR(100,ORIG,6)=NATR_U_DUZ_U_ORNOW_"^^Renewal cancelled"
"RTN","ORCSEND",107,0)
 . D MSG^ORMBLD(ORIG,"DC") I "^1^13^"'[$P(^OR(100,ORIG,3),U,3) K ^(6) Q
"RTN","ORCSEND",108,0)
 . S:'$$ACTV^ORX1(NATR) $P(^OR(100,ORIG,3),U,7)=0
"RTN","ORCSEND",109,0)
 Q
"RTN","ORCSEND",110,0)
 ;
"RTN","ORCSEND",111,0)
CANCEL(IFN) ; -- Cancel any outstanding actions for order IFN 
"RTN","ORCSEND",112,0)
 N I S I=0
"RTN","ORCSEND",113,0)
 F  S I=$O(^OR(100,IFN,8,I)) Q:I'>0  I $P(^(I,0),U,15)=11 S $P(^(0),U,15)=13 D:$P(^(0),U,4)=2 SIGN^ORCSAVE2(IFN,"","",5,I) ; cancelled, sig not reqd now
"RTN","ORCSEND",114,0)
 Q
"RTN","ORCSEND",115,0)
 ;
"RTN","ORCSEND",116,0)
HD ; -- Hold order ORIFN
"RTN","ORCSEND",117,0)
 N STS,ORSAVE I 'ORDA S ORERR="1^Unable to hold" Q
"RTN","ORCSEND",118,0)
 I SIGNREQD,'SIGNED,'RELSTS S ORERR=$$NEEDSIG Q
"RTN","ORCSEND",119,0)
 D RELEASE^ORCSAVE2(ORIFN,ORDA,ORNOW,DUZ,$G(NATURE))
"RTN","ORCSEND",120,0)
 S ORSAVE=ORIFN D MSG^ORMBLD((ORIFN_";"_ORDA),"HD") S ORIFN=ORSAVE
"RTN","ORCSEND",121,0)
 S STS=$P($G(^OR(100,ORIFN,3)),U,3) I STS=3 S $P(^(3),U,7)=ORDA D SET^ORDD100(ORIFN,ORDA)
"RTN","ORCSEND",122,0)
 I STS'=3 S ORERR="1^"_$$WHY(ORIFN,ORDA) D:'SIGNED&SIGNREQD NOSIG
"RTN","ORCSEND",123,0)
 Q
"RTN","ORCSEND",124,0)
 ;
"RTN","ORCSEND",125,0)
RL ; -- Release hold on order ORIFN
"RTN","ORCSEND",126,0)
 N STS,ORSAVE,ORHD I 'ORDA S ORERR="1^Unable to release hold" Q
"RTN","ORCSEND",127,0)
 I SIGNREQD,'SIGNED,'RELSTS S ORERR=$$NEEDSIG Q
"RTN","ORCSEND",128,0)
 D RELEASE^ORCSAVE2(ORIFN,ORDA,ORNOW,DUZ,$G(NATURE))
"RTN","ORCSEND",129,0)
 S ORSAVE=ORIFN D MSG^ORMBLD((ORIFN_";"_ORDA),"RL") S ORIFN=ORSAVE
"RTN","ORCSEND",130,0)
 S STS=$P($G(^OR(100,ORIFN,3)),U,3),ORHD=+$P($G(^(3)),U,7)
"RTN","ORCSEND",131,0)
 I STS'=3 S $P(^OR(100,ORIFN,3),U,7)=ORDA,$P(^(8,ORHD,2),U,1,2)=ORNOW_U_DUZ D SET^ORDD100(ORIFN,ORDA)
"RTN","ORCSEND",132,0)
 I STS=3 S ORERR="1^"_$$WHY(ORIFN,ORDA) D:'SIGNED&SIGNREQD NOSIG
"RTN","ORCSEND",133,0)
 Q
"RTN","ORCSEND",134,0)
 ;
"RTN","ORCSEND",135,0)
FL ; -- Flag order ORIFN
"RTN","ORCSEND",136,0)
 Q
"RTN","ORCSEND",137,0)
 ;
"RTN","ORCSEND",138,0)
UF ; -- Unflag order ORIFN
"RTN","ORCSEND",139,0)
 Q
"RTN","ORCSEND",140,0)
 ;
"RTN","ORCSEND",141,0)
CM ; -- Add Ward comments to order ORIFN
"RTN","ORCSEND",142,0)
 Q
"RTN","ORCSEND",143,0)
 ;
"RTN","ORCSEND",144,0)
VR ; -- Verify order ORIFN
"RTN","ORCSEND",145,0)
 I 'ORDA!(SIGSTS=2) S ORERR="1^Unable to verify" Q
"RTN","ORCSEND",146,0)
 I "^N^C^R^"'[(U_$G(ORVER)_U) S ORERR="1^Unable to verify" Q
"RTN","ORCSEND",147,0)
 D VERIFY^ORCSAVE2(ORIFN,ORDA,ORVER,DUZ,ORNOW)
"RTN","ORCSEND",148,0)
 ; -- send HL7 msg to Pharmacy if Nurse-Verified, [Sts=pending]
"RTN","ORCSEND",149,0)
 Q:ORVER'="N"  N ORSTS,ORPKG,ORX
"RTN","ORCSEND",150,0)
 S ORX=$P($G(^OR(100,ORIFN,8,ORDA,0)),U,2) Q:ORX'="NW"&(ORX'="XX")
"RTN","ORCSEND",151,0)
 S ORPKG=+$P($G(^OR(100,ORIFN,0)),U,14),ORSTS=$P($G(^(3)),U,3)
"RTN","ORCSEND",152,0)
 ;I ORSTS=5!$L($T(ZV^ORMPS)),$$NMSP^ORCD(ORPKG)="PS" D VER^ORMBLDPS(ORIFN)
"RTN","ORCSEND",153,0)
 I $$NMSP^ORCD(ORPKG)="PS" D VER^ORMBLDPS(ORIFN) Q
"RTN","ORCSEND",154,0)
 D VER^ORMBLDOR(ORIFN)
"RTN","ORCSEND",155,0)
 Q
"RTN","ORCSEND",156,0)
 ;
"RTN","ORCSEND",157,0)
NEEDSIG() ; -- Msg
"RTN","ORCSEND",158,0)
 Q "1^This order requires a signature."
"RTN","ORCSEND",159,0)
 ;
"RTN","ORCSEND",160,0)
WHY(IFN,DA) ; -- Return reason request was rejected
"RTN","ORCSEND",161,0)
 N X S X=$G(^OR(100,IFN,8,DA,1))
"RTN","ORCSEND",162,0)
 S:'$L(X) X="Unable to "_$S(ACTION="HD":"hold",ACTION="RL":"release hold",ACTION="DC":"discontinue",ACTION="XX":"change",ACTION="RN":"renew",1:"release")
"RTN","ORCSEND",163,0)
 Q X
"RTN","ORCSEND",164,0)
 ;
"RTN","ORCSEND",165,0)
NOSIG ; -- Mark order as Sig not Req'd due to cancel/reject
"RTN","ORCSEND",166,0)
 D SIGN^ORCSAVE2(ORIFN,"","",5,ORDA) S SIGNREQD=0
"RTN","ORCSEND",167,0)
 Q
"RTN","ORCSEND",168,0)
 ;
"RTN","ORCSEND",169,0)
READY(IFN,ACT) ; -- Ready to release?
"RTN","ORCSEND",170,0)
 N X,Y,OR0,OR3,ORA
"RTN","ORCSEND",171,0)
 I ACTION="VR" S Y=1 G RQ ; no action to release
"RTN","ORCSEND",172,0)
 I 'ACT,ACTION="DC" S Y=1 G RQ ; cancel a duplicate
"RTN","ORCSEND",173,0)
 S Y=0,OR0=$G(^OR(100,IFN,0)),OR3=$G(^(3)),ORA=$G(^(8,ACT,0))
"RTN","ORCSEND",174,0)
 I $P(ORA,U,15)=11 S Y=1 G RQ ; unreleased
"RTN","ORCSEND",175,0)
 I $P(ORA,U,15)=10 D  G RQ ; delayed
"RTN","ORCSEND",176,0)
 . I $G(^DPT(+ORVP,.105)),$$GET1^DIQ(9.4,+$P(OR0,U,14)_",",1)="PSO" S Y=1 Q
"RTN","ORCSEND",177,0)
 . Q:'RELSTS  N ORIG S ORIG=+$P(OR3,U,5)
"RTN","ORCSEND",178,0)
 . I 'SIGNED,$L($G(NATURE)) S $P(ORA,U,17)=DUZ,$P(ORA,U,12)=$S(NATURE:NATURE,1:+$O(^ORD(100.02,"C",NATURE,0))),^OR(100,IFN,8,ACT,0)=ORA
"RTN","ORCSEND",179,0)
 . Q:$P(OR3,U,11)'=1!('ORIG)  ;dc original if signed edit
"RTN","ORCSEND",180,0)
 . D STATUS^ORCSAVE2(ORIG,12)
"RTN","ORCSEND",181,0)
 . S ^OR(100,ORIG,6)=+$O(^ORD(100.02,"C","C",0))_U_DUZ_U_ORNOW
"RTN","ORCSEND",182,0)
 . S $P(^OR(100,ORIG,3),U,7)=0,$P(^(8,1,0),U,15)=12 D:$P($G(^(0)),U,4)=2 SIGN^ORCSAVE2(ORIG,,,5,1)
"RTN","ORCSEND",183,0)
 I $P(OR3,U,3)=11,$P(ORA,U,2)="NW" S Y=1 ; Action Sts = "" (old)
"RTN","ORCSEND",184,0)
RQ I +$$SWSTAT^IBBAPI() D:Y=1 EN^ORWPFSS4(+IFN) ; Associate PFSS Account Reference with order, Patch OR*3.0*228 IA #4663
"RTN","ORCSEND",185,0)
 Q Y
"RTN","ORMBLDOR")
0^3^B5650360
"RTN","ORMBLDOR",1,0)
ORMBLDOR ; SLC/MKB - Build outgoing OR msgs ;11/17/00  11:11
"RTN","ORMBLDOR",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**97,390**;Dec 17, 1997;Build 412
"RTN","ORMBLDOR",3,0)
EN ; -- Generic orders: Activity, Nursing, Diagnosis, Condition, Vitals
"RTN","ORMBLDOR",4,0)
 N OI,START,STOP,SCH,TXT
"RTN","ORMBLDOR",5,0)
 S OI=$G(ORDIALOG($$PTR("ORDERABLE ITEM"),1))
"RTN","ORMBLDOR",6,0)
 S TXT=$G(ORDIALOG($$PTR("FREE TEXT 1"),1))
"RTN","ORMBLDOR",7,0)
 S START=$P(OR0,U,8),STOP=$P(OR0,U,9),SCH=""
"RTN","ORMBLDOR",8,0)
 S:ORDG=$O(^ORD(100.98,"B","V/M",0)) SCH=$$VALUE^ORCSAVE2(IFN,"SCHEDULE")
"RTN","ORMBLDOR",9,0)
 S $P(ORMSG(4),"|",8)=U_SCH_"^^"_$$HL7DATE(START)_U_$$HL7DATE(STOP) ; QT
"RTN","ORMBLDOR",10,0)
 S ORMSG(5)="OBR||||"_$$USID^ORMBLD(OI)
"RTN","ORMBLDOR",11,0)
 S:$L(TXT) ORMSG(6)="NTE|1|L|"_TXT ; order text?
"RTN","ORMBLDOR",12,0)
 Q
"RTN","ORMBLDOR",13,0)
 ;
"RTN","ORMBLDOR",14,0)
ADT ; -- M.A.S. event requests
"RTN","ORMBLDOR",15,0)
 Q  N PROV,PROV1,ORIFN
"RTN","ORMBLDOR",16,0)
 S PROV=+$G(ORDIALOG($$PTR("PROVIDER"),1)) I 'PROV D EN Q
"RTN","ORMBLDOR",17,0)
 S PROV1=+$G(ORDIALOG($$PTR("PROVIDER 1"),1)),PKG="DGPM"
"RTN","ORMBLDOR",18,0)
 S $P(ORMSG(1),"|",5)="M.A.S.",$P(ORMSG(1),"|",9)="ADT"
"RTN","ORMBLDOR",19,0)
 K ORMSG(4) S ORMSG(4)=ORMSG(3),ORMSG(3)=ORMSG(2)
"RTN","ORMBLDOR",20,0)
 S ORMSG(2)="EVN|A08|"_$$HL7DATE($$NOW^XLFDT)
"RTN","ORMBLDOR",21,0)
 S $P(ORMSG(4),"|",8)=PROV
"RTN","ORMBLDOR",22,0)
 S:PROV1 ORMSG(5)="ZDG|"_PROV1
"RTN","ORMBLDOR",23,0)
 S ORIFN=+IFN D NW^ORMORG ; set status, start date
"RTN","ORMBLDOR",24,0)
 Q
"RTN","ORMBLDOR",25,0)
 ;
"RTN","ORMBLDOR",26,0)
PTR(X) ; -- Returns ptr value of prompt X in #101.41
"RTN","ORMBLDOR",27,0)
 Q +$O(^ORD(101.41,"AB",$E("OR GTX "_X,1,63),0))
"RTN","ORMBLDOR",28,0)
 ;
"RTN","ORMBLDOR",29,0)
HL7DATE(D) ; -- FM->HL7 format
"RTN","ORMBLDOR",30,0)
 Q $$FMTHL7^XLFDT(D)  ;**97
"RTN","ORMBLDOR",31,0)
 ;
"RTN","ORMBLDOR",32,0)
COMP(IFN) ; -- send message for completed orders
"RTN","ORMBLDOR",33,0)
 N OR0,ORMSG S OR0=$G(^OR(100,+IFN,0))
"RTN","ORMBLDOR",34,0)
 S ORMSG(1)=$$MSH^ORMBLD("ORM","OR"),ORMSG(2)=$$PID^ORMBLD($P(OR0,U,2))
"RTN","ORMBLDOR",35,0)
 S ORMSG(3)=$$PV1^ORMBLD($P(OR0,U,2),$P(OR0,U,12),+$P(OR0,U,10))
"RTN","ORMBLDOR",36,0)
 S ORMSG(4)="ORC|SC|"_+IFN_"^OR|"_+IFN_"^OR||CM||||||"_DUZ_"||||"_$$FMTHL7^XLFDT($$NOW^XLFDT)
"RTN","ORMBLDOR",37,0)
 D MSG^XQOR("OR EVSEND VPR",.ORMSG)
"RTN","ORMBLDOR",38,0)
 Q
"RTN","ORMBLDOR",39,0)
 ;
"RTN","ORMBLDOR",40,0)
VER(IFN) ; -- Send msg for verified orders
"RTN","ORMBLDOR",41,0)
 N OR0,ORMSG S OR0=$G(^OR(100,+IFN,0))
"RTN","ORMBLDOR",42,0)
 S ORMSG(1)=$$MSH^ORMBLD("ORM","OR"),ORMSG(2)=$$PID^ORMBLD($P(OR0,U,2))
"RTN","ORMBLDOR",43,0)
 S ORMSG(3)=$$PV1^ORMBLD($P(OR0,U,2),$P(OR0,U,12),+$P(OR0,U,10))
"RTN","ORMBLDOR",44,0)
 S ORMSG(4)="ORC|ZV|"_IFN_"^OR|"_$G(^OR(100,+IFN,4))_U_$$NMSP^ORCD($P(OR0,U,14))_"||||||||"_DUZ_"||||"_$$FMTHL7^XLFDT($$NOW^XLFDT)
"RTN","ORMBLDOR",45,0)
 D MSG^XQOR("OR EVSEND VPR",.ORMSG)
"RTN","ORMBLDOR",46,0)
 Q
"RTN","ORWDXA")
0^4^B83177974
"RTN","ORWDXA",1,0)
ORWDXA ; SLC/KCM/JLI - Utilites for Order Actions ;12/14/12  13:38
"RTN","ORWDXA",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,116,132,148,141,149,187,213,195,215,243,280,306,390**;Dec 17, 1997;Build 412
"RTN","ORWDXA",3,0)
 ;
"RTN","ORWDXA",4,0)
VALID(VAL,ORID,ACTION,ORNP,ORWNAT) ; Is action valid for order?
"RTN","ORWDXA",5,0)
 N ORACT,ORVP,ORVER,ORIFN,PRTID S VAL="",PRTID=0
"RTN","ORWDXA",6,0)
 I +ORID=0 S VAL="This order has been deleted." Q
"RTN","ORWDXA",7,0)
 I '$D(^OR(100,+ORID,0)) S VAL="This order has been deleted!" Q
"RTN","ORWDXA",8,0)
 I ACTION="XFR",'$L($T(XFR^ORCACT01)) S ACTION="RW" ; for pre-POE
"RTN","ORWDXA",9,0)
 N ORNSS S ORNSS=1
"RTN","ORWDXA",10,0)
 I (ACTION="RN") D VALSCH^ORWNSS(.ORNSS,ORID)
"RTN","ORWDXA",11,0)
 I ORNSS=0 S VAL="This order contains an invalid administration schedule." Q
"RTN","ORWDXA",12,0)
 I (ACTION="RN") D ISVALIV^ORWDPS33(.VAL,ORID,ACTION) I $L(VAL)>0 Q
"RTN","ORWDXA",13,0)
 S ORIFN=ORID,ORVP=$P(^OR(100,+ORID,0),U,2)  ; ORCACT0 expects
"RTN","ORWDXA",14,0)
 I (ACTION="RN") D  Q:$L(VAL)
"RTN","ORWDXA",15,0)
 . N DLG S DLG=$P(^OR(100,+ORID,0),U,5) Q:DLG'[";ORD(101.41,"
"RTN","ORWDXA",16,0)
 . I $G(^ORD(101.41,+DLG,3))'["PROVIDER^ORCDPSIV" Q
"RTN","ORWDXA",17,0)
 . D AUTH^ORWDPS32(.VAL,ORNP)
"RTN","ORWDXA",18,0)
 . I VAL S VAL=$P(VAL,U,2)
"RTN","ORWDXA",19,0)
 . E  S VAL=""
"RTN","ORWDXA",20,0)
 S ORVER=$S(ACTION="CR":"R",$D(^XUSEC("ORELSE",DUZ)):"N",$D(^XUSEC("OREMAS",DUZ)):"C",1:"^")
"RTN","ORWDXA",21,0)
 I ACTION="CR" S ACTION="VR"
"RTN","ORWDXA",22,0)
 I (ACTION="ES")!(ACTION="OC")!(ACTION="RS") S ORACT=ACTION ; why not defined???
"RTN","ORWDXA",23,0)
 I (ACTION="VR"),'($D(^XUSEC("ORELSE",DUZ))!$D(^XUSEC("OREMAS",DUZ))) D  Q
"RTN","ORWDXA",24,0)
 . S VAL="You are not authorized to verify these orders."
"RTN","ORWDXA",25,0)
 I $L(VAL) Q
"RTN","ORWDXA",26,0)
 N OIIEN,ISIV,IVOD
"RTN","ORWDXA",27,0)
 S (ISIV,OIIEN,IVOD)=0
"RTN","ORWDXA",28,0)
 I (ACTION="RW")!(ACTION="XX")!(ACTION="XFR") D  Q:$L(VAL)
"RTN","ORWDXA",29,0)
 . S ISIV=$P(^OR(100,+ORID,0),U,11)
"RTN","ORWDXA",30,0)
 . I ISIV,($P(^ORD(100.98,ISIV,0),U,3)="IV RX") S IVOD=1
"RTN","ORWDXA",31,0)
 . D:'IVOD GTORITM^ORWDXR(.OIIEN,+ORID)
"RTN","ORWDXA",32,0)
 . D:OIIEN ISACTOI(.VAL,OIIEN) I $L(VAL)>0 Q
"RTN","ORWDXA",33,0)
 . N DLG,FRM
"RTN","ORWDXA",34,0)
 . S DLG=$P(^OR(100,+ORID,0),U,5),FRM=0
"RTN","ORWDXA",35,0)
 . I $P(DLG,";",2)'="ORD(101.41," S DLG=0
"RTN","ORWDXA",36,0)
 . I DLG D FORMID^ORWDXM(.FRM,+DLG)
"RTN","ORWDXA",37,0)
 . I '(DLG&FRM) D
"RTN","ORWDXA",38,0)
 . . S VAL="Copy & Change are not implemented for this order that predates CPRS."
"RTN","ORWDXA",39,0)
 N OREBUILD
"RTN","ORWDXA",40,0)
 ;I (ACTION="RW")!(ACTION="XFR")!(ACTION="RN") D ISVALIV^ORWDPS33(.VAL,ORID,ACTION) I $L(VAL)>0 Q
"RTN","ORWDXA",41,0)
 I $$VALID^ORCACT0(ORID,ACTION,.VAL,$G(ORWNAT)) S VAL="" ; VAL=error
"RTN","ORWDXA",42,0)
 I ACTION="RN",$$UPCTCHK(ORID) S VAL="Cannot renew this order due to an illegal character ""^"" in the comments or patient instructions."
"RTN","ORWDXA",43,0)
 I ACTION="RW",$$UPCTCHK(ORID) S VAL="Cannot copy this order due to an illegal character ""^"" in the comments or patient instructions."
"RTN","ORWDXA",44,0)
 Q
"RTN","ORWDXA",45,0)
 ;
"RTN","ORWDXA",46,0)
HOLD(REC,ORID,ORNP) ; Place order on hold
"RTN","ORWDXA",47,0)
 N ACTDA
"RTN","ORWDXA",48,0)
 S ACTDA=$$ACTION^ORCSAVE("HD",+ORID,ORNP)
"RTN","ORWDXA",49,0)
 D GETBYIFN^ORWORR(.REC,+ORID_";"_ACTDA)
"RTN","ORWDXA",50,0)
 Q
"RTN","ORWDXA",51,0)
UNHOLD(REC,ORID,ORNP) ; Release order from hold
"RTN","ORWDXA",52,0)
 N ACTDA
"RTN","ORWDXA",53,0)
 S ACTDA=$$ACTION^ORCSAVE("RL",+ORID,ORNP)
"RTN","ORWDXA",54,0)
 D GETBYIFN^ORWORR(.REC,+ORID_";"_ACTDA)
"RTN","ORWDXA",55,0)
 Q
"RTN","ORWDXA",56,0)
DC(REC,ORID,ORNP,ORL,REASON,DCORIG,ISNEWORD) ; Discontinue/Cancel/Delete order
"RTN","ORWDXA",57,0)
 N NATURE,CREATE,PRINT,STATUS,ACTDA,SIGSTS
"RTN","ORWDXA",58,0)
 N X3,X8,CURRACT
"RTN","ORWDXA",59,0)
 Q:'+ORID
"RTN","ORWDXA",60,0)
 I $G(DCORIG)="" S DCORIG=0
"RTN","ORWDXA",61,0)
 S CURRACT=0
"RTN","ORWDXA",62,0)
 S ORL(2)=ORL_";SC(",ORL=ORL(2),NATURE=""
"RTN","ORWDXA",63,0)
 I REASON S NATURE=$P(^ORD(100.02,$P(^ORD(100.03,REASON,0),U,7),0),U,2)
"RTN","ORWDXA",64,0)
 S:NATURE="" NATURE="W"  ; S:ORNP=DUZ NATURE="E"
"RTN","ORWDXA",65,0)
 ;change the way create work to support forcing signature for all DC
"RTN","ORWDXA",66,0)
 ;reasons
"RTN","ORWDXA",67,0)
 S CREATE=1,PRINT=$$PRINT^ORCACT2(NATURE)
"RTN","ORWDXA",68,0)
 ;S CREATE=$$CREATE^ORX1(NATURE)
"RTN","ORWDXA",69,0)
 S X3=$G(^OR(100,+ORID,3))
"RTN","ORWDXA",70,0)
 S CURRACT=$P(X3,U,7) S:CURRACT<1 CURRACT=+$O(^OR(100,+ORID,8,"?"),-1)
"RTN","ORWDXA",71,0)
 I '$D(^OR(100,+ORID,8,+$P(ORID,";",2),0)) D
"RTN","ORWDXA",72,0)
 . S X8=$G(^OR(100,+ORID,8,CURRACT,0))
"RTN","ORWDXA",73,0)
 . S SIGSTS=$P(X8,U,4)
"RTN","ORWDXA",74,0)
 . S $P(ORID,";",2)=CURRACT
"RTN","ORWDXA",75,0)
 E  D
"RTN","ORWDXA",76,0)
 . S X8=^OR(100,+ORID,8,+$P(ORID,";",2),0)
"RTN","ORWDXA",77,0)
 . S SIGSTS=$P(X8,U,4)
"RTN","ORWDXA",78,0)
 I '$D(SIGSTS) S SIGSTS=1
"RTN","ORWDXA",79,0)
 S STATUS=$P($G(^OR(100,+ORID,8,+$P(ORID,";",2),0)),U,15)
"RTN","ORWDXA",80,0)
 I (STATUS=10)!(STATUS=11) D  Q   ; delete/cancel unreleased order
"RTN","ORWDXA",81,0)
 . N RPLORD
"RTN","ORWDXA",82,0)
 . S RPLORD=$P($G(^OR(100,+ORID,3)),U,5)    ; replaced order
"RTN","ORWDXA",83,0)
 . D GETBYIFN^ORWORR(.REC,ORID)
"RTN","ORWDXA",84,0)
 . I STATUS=10,($P(X8,U,4)'=2) D  ; CANCEL signed, delayed, unreleased
"RTN","ORWDXA",85,0)
 . . ; taken from CLRDLY^ORCACT2
"RTN","ORWDXA",86,0)
 . . I REASON D SET^ORCACT2(+ORID,NATURE,REASON,,DCORIG)
"RTN","ORWDXA",87,0)
 . . I 'REASON D SET^ORCACT2(+ORID,"M","","Delayed Order Cancelled",DCORIG)
"RTN","ORWDXA",88,0)
 . . D STATUS^ORCSAVE2(+ORID,13) S $P(^OR(100,+ORID,8,1,0),U,15)=13
"RTN","ORWDXA",89,0)
 . E  D                           ; CANCEL OR DELETE unsigned, unreleased
"RTN","ORWDXA",90,0)
 . . I $P(X8,U,2)="DC" K ^OR(100,+ORID,6)
"RTN","ORWDXA",91,0)
 . . ; delete fwd ptr to order about to be deleted
"RTN","ORWDXA",92,0)
 . . I RPLORD,$P(X8,U,2)="NW" S $P(^OR(100,RPLORD,3),U,6)=""
"RTN","ORWDXA",93,0)
 . . ; delete ptr to order in Patient Event file #100.2
"RTN","ORWDXA",94,0)
 . . N EVT S EVT=$P($G(^OR(100,+ORID,0)),U,17) I EVT,EVT=+$O(^ORE(100.2,"AO",+ORID,0)) S $P(^ORE(100.2,EVT,0),U,4)="" K ^ORE(100.2,"AO",+ORID,EVT)
"RTN","ORWDXA",95,0)
 . . I $G(ISNEWORD) D DELETE^ORCSAVE2(ORID)
"RTN","ORWDXA",96,0)
 . . I '$G(ISNEWORD) D CANCEL^ORCSAVE2(ORID)
"RTN","ORWDXA",97,0)
 . I RPLORD,'(SIGSTS=1) S ORID=RPLORD  ; for Renews & Changes, show replaced order
"RTN","ORWDXA",98,0)
 . I '$D(^OR(100,+ORID)) D
"RTN","ORWDXA",99,0)
 . . S $P(REC(1),U)="~0",REC(2)="tDELETED: "_$E(REC(2),2,245)
"RTN","ORWDXA",100,0)
 . E  D
"RTN","ORWDXA",101,0)
 . . K REC
"RTN","ORWDXA",102,0)
 . . D GETBYIFN^ORWORR(.REC,+ORID_";"_$P($G(^OR(100,+ORID,3)),U,7))
"RTN","ORWDXA",103,0)
 . S $P(REC(1),U,14)=2 ; DCType = deletion
"RTN","ORWDXA",104,0)
 S ACTDA=$$ACTION^ORCSAVE("DC",+ORID,ORNP)
"RTN","ORWDXA",105,0)
 D SET^ORCACT2(+ORID,NATURE,REASON,,DCORIG)
"RTN","ORWDXA",106,0)
 D GETBYIFN^ORWORR(.REC,+ORID_";"_ACTDA)
"RTN","ORWDXA",107,0)
 S $P(REC(1),U,14)=$S(CREATE:1,1:3)  ;DCType - 1=NewOrder, 3=NewStatus
"RTN","ORWDXA",108,0)
 N PKG
"RTN","ORWDXA",109,0)
 S PKG=$P($G(^OR(100,+ORID,0)),U,14)
"RTN","ORWDXA",110,0)
 S PKG=$$NMSP^ORCD(PKG)
"RTN","ORWDXA",111,0)
 I REASON=16&(PKG="PS") D
"RTN","ORWDXA",112,0)
 . N XMB
"RTN","ORWDXA",113,0)
 . S XMB="OR DRUG ORDER CANCELLED"
"RTN","ORWDXA",114,0)
 . S XMB(1)=$P($G(REC(2)),"tDiscontinue",2),XMB(4)=$P($G(^VA(200,DUZ,0)),U)
"RTN","ORWDXA",115,0)
 . S XMB(2)=+ORID
"RTN","ORWDXA",116,0)
 . S XMB(3)=+$P($G(^OR(100,+ORID,0)),U,2)
"RTN","ORWDXA",117,0)
 . S XMB(3)=$P($G(^DPT(XMB(3),0)),U)
"RTN","ORWDXA",118,0)
 . D ^XMB
"RTN","ORWDXA",119,0)
 Q
"RTN","ORWDXA",120,0)
DCREQIEN(VAL) ; Return IEN for Req Phys Cancelled reason
"RTN","ORWDXA",121,0)
 S VAL=$O(^ORD(100.03,"S","REQ",0))
"RTN","ORWDXA",122,0)
 Q
"RTN","ORWDXA",123,0)
COMPLETE(REC,ORID,ESCODE) ; Complete order (generic)
"RTN","ORWDXA",124,0)
 ;N X S X=+$E($$NOW^XLFDT,1,12)
"RTN","ORWDXA",125,0)
 ;D DATES^ORCSAVE2(+ORID,,X)
"RTN","ORWDXA",126,0)
 ;D STATUS^ORCSAVE2(+ORID,2)
"RTN","ORWDXA",127,0)
 ; validate ESCode
"RTN","ORWDXA",128,0)
 D COMP^ORCSAVE2(ORID)
"RTN","ORWDXA",129,0)
 D COMP^ORMBLDOR(ORID)
"RTN","ORWDXA",130,0)
 D GETBYIFN^ORWORR(.REC,ORID)
"RTN","ORWDXA",131,0)
 Q
"RTN","ORWDXA",132,0)
VERIFY(REC,ORID,ESCODE,ORVER) ; Verify order
"RTN","ORWDXA",133,0)
 ; validate ESCode
"RTN","ORWDXA",134,0)
 S ORVER=$G(ORVER,$S($D(^XUSEC("ORELSE",DUZ)):"N",$D(^XUSEC("OREMAS",DUZ)):"C",1:U))
"RTN","ORWDXA",135,0)
 I ORVER'=U D
"RTN","ORWDXA",136,0)
 . N ORIFN,ORES,ORI
"RTN","ORWDXA",137,0)
 . ; VERIFY any replaced orders:
"RTN","ORWDXA",138,0)
 . S ORIFN=ORID,ORES(ORIFN)="" D REPLCD^ORCACT1
"RTN","ORWDXA",139,0)
 . S ORI="" F  S ORI=$O(ORES(ORI)) Q:ORI=""  D EN^ORCSEND(ORI,"VR","",""),UNLK1^ORX2(+ORI):ORI'=ORID ;ORID locked prior
"RTN","ORWDXA",140,0)
 D GETBYIFN^ORWORR(.REC,ORID)
"RTN","ORWDXA",141,0)
 Q
"RTN","ORWDXA",142,0)
ALERT(DUMMY,ORID,ORDUZ) ; alert user (ORDUZ) when order (ORID) resulted
"RTN","ORWDXA",143,0)
 ;if no user passed, use ordering provider:
"RTN","ORWDXA",144,0)
 I $G(ORDUZ)<1 S ORDUZ=+$$ORDERER^ORQOR2(+ORID)
"RTN","ORWDXA",145,0)
 I $L($G(ORDUZ))<1 S ORDUZ=DUZ
"RTN","ORWDXA",146,0)
 S DUMMY=1,$P(^OR(100,+ORID,3),U,10)=ORDUZ
"RTN","ORWDXA",147,0)
 Q
"RTN","ORWDXA",148,0)
FLAG(REC,ORIFN,OREASON,ORNP) ; Flag order
"RTN","ORWDXA",149,0)
 N ORB,ORVP,DA,ORPS
"RTN","ORWDXA",150,0)
 D BULLETIN
"RTN","ORWDXA",151,0)
 S DA=$P(ORIFN,";",2),ORVP=+$P(^OR(100,+ORIFN,0),U,2)
"RTN","ORWDXA",152,0)
 K ^OR(100,+ORIFN,8,DA,3) S ^(3)="1^"_$G(XMZ)_U_+$E($$NOW^XLFDT,1,12)_U_DUZ_U_OREASON_$S($G(ORNP):"^^^^"_+ORNP,1:"")
"RTN","ORWDXA",153,0)
 D KILL^XM,MSG^ORCFLAG(ORIFN)
"RTN","ORWDXA",154,0)
 S $P(^OR(100,+ORIFN,3),U)=$$NOW^XLFDT ; Last Activity
"RTN","ORWDXA",155,0)
 I +$G(ORNP)<1 S ORNP=+$P($G(^OR(100,+ORIFN,8,DA,0)),U,3)
"RTN","ORWDXA",156,0)
 S ORB=+ORVP_U_+ORIFN_U_ORNP_"^1" D EN^OCXOERR(ORB) ; notification
"RTN","ORWDXA",157,0)
 D GETBYIFN^ORWORR(.REC,ORIFN)
"RTN","ORWDXA",158,0)
 Q
"RTN","ORWDXA",159,0)
BULLETIN ; flagged order bulletin
"RTN","ORWDXA",160,0)
 N OR0,OR3,ORDTXT,XMB,XMY,XMDUZ,ORENT,BULL,ORSRV,ORUSR
"RTN","ORWDXA",161,0)
 S OR0=$G(^OR(100,+ORIFN,0)),OR3=$G(^(3))
"RTN","ORWDXA",162,0)
 ;CLA - 3/21/96:
"RTN","ORWDXA",163,0)
 S ORUSR=+$P(OR0,U,4)
"RTN","ORWDXA",164,0)
 S ORSRV=$G(^VA(200,ORUSR,5)) I +ORSRV>0 S ORSRV=$P(ORSRV,U)
"RTN","ORWDXA",165,0)
 S ORENT="USR.`"_ORUSR_"^SRV.`"_$G(ORSRV)_"^DIV^SYS^PKG"
"RTN","ORWDXA",166,0)
 S BULL=$$GET^XPAR(ORENT,"ORB FLAGGED ORDERS BULLETIN",1,"Q")
"RTN","ORWDXA",167,0)
 Q:$G(BULL)'="Y"   ;quit if parm val not 'Y'es
"RTN","ORWDXA",168,0)
 ;
"RTN","ORWDXA",169,0)
 S XMB="OR FLAGGED ORDER",XMDUZ=DUZ,XMY(+$P(OR0,U,4))=""
"RTN","ORWDXA",170,0)
 S XMB(1)=$P(^DPT(+$P(OR0,U,2),0),U),XMB(2)=$P(^(0),U,9),XMB(3)="" ;sb AGE
"RTN","ORWDXA",171,0)
 S XMB(4)=$$FMTE^XLFDT($P(OR0,U,7))
"RTN","ORWDXA",172,0)
 D TEXT^ORQ12(.ORDTXT,+ORIFN,80)
"RTN","ORWDXA",173,0)
 S XMB(5)=$G(ORDTXT(1)),XMB(6)=$G(ORDTXT(2)),XMB(7)=$G(ORDTXT(3))
"RTN","ORWDXA",174,0)
 S XMB(8)=$$FMTE^XLFDT($P(OR0,U,8)),XMB(9)=$$FMTE^XLFDT($P(OR0,U,9)),XMB(10)=OREASON
"RTN","ORWDXA",175,0)
 S XMB(11)=$P($G(^ORD(100.01,+$P(OR3,U,3),0)),U)
"RTN","ORWDXA",176,0)
 D EN^XMB
"RTN","ORWDXA",177,0)
 Q
"RTN","ORWDXA",178,0)
UNFLAG(REC,ORIFN,OREASON) ; Unflag order
"RTN","ORWDXA",179,0)
 N DA,ORB,ORNP,ORVP,ORPS
"RTN","ORWDXA",180,0)
 S DA=$P(ORIFN,";",2),ORVP=+$P(^OR(100,+ORIFN,0),U,2)
"RTN","ORWDXA",181,0)
 S $P(^OR(100,+ORIFN,8,DA,3),U)=0,$P(^(3),U,6,8)=+$E($$NOW^XLFDT,1,12)_U_DUZ_U_OREASON D MSG^ORCFLAG(ORIFN)
"RTN","ORWDXA",182,0)
 S $P(^OR(100,+ORIFN,3),U)=$$NOW^XLFDT  ; Last Activity
"RTN","ORWDXA",183,0)
 S ORNP=+$P($G(^OR(100,+ORIFN,8,DA,0)),U,3)
"RTN","ORWDXA",184,0)
 S ORB=+ORVP_U_+ORIFN_U_ORNP_"^0" D EN^OCXOERR(ORB) ; notification
"RTN","ORWDXA",185,0)
 D GETBYIFN^ORWORR(.REC,ORIFN)
"RTN","ORWDXA",186,0)
 Q
"RTN","ORWDXA",187,0)
FLAGTXT(LST,ORID) ; flag reason
"RTN","ORWDXA",188,0)
 N FLAG
"RTN","ORWDXA",189,0)
 S FLAG=$G(^OR(100,+ORID,8,$P(ORID,";",2),3))
"RTN","ORWDXA",190,0)
 S LST(1)="FLAGGED: "_$$FMTE^XLFDT($P(FLAG,U,3))_" by "_$P($G(^VA(200,+$P(FLAG,U,4),0)),U)
"RTN","ORWDXA",191,0)
 S LST(2)=$P(FLAG,U,5) ; reason
"RTN","ORWDXA",192,0)
 Q
"RTN","ORWDXA",193,0)
WCGET(LST,ORID) ; ward comments
"RTN","ORWDXA",194,0)
 N I,ORIFN,ACT S ORIFN=+ORID,ACT=+$P(ORID,";",2)
"RTN","ORWDXA",195,0)
 S I=0 F  S I=$O(^OR(100,ORIFN,8,ACT,5,I)) Q:'I  S LST(I)=$G(^(I,0))
"RTN","ORWDXA",196,0)
 Q
"RTN","ORWDXA",197,0)
WCPUT(ERR,ORID,WCLST) ; Set ward comments
"RTN","ORWDXA",198,0)
 N DIERR,ERRLST,ORIFN,ACT S ORIFN=+ORID,ACT=+$P(ORID,";",2)
"RTN","ORWDXA",199,0)
 D WP^DIE(100.008,ACT_","_ORIFN_",",50,"","WCLST","ERRLST")
"RTN","ORWDXA",200,0)
 S ERR="" I $D(DIERR) S ERR="An error occurred while saving comments."
"RTN","ORWDXA",201,0)
 Q
"RTN","ORWDXA",202,0)
OFCPLX(ORY,ORID,PRTORDER) ; is ORID child of PRTORDER
"RTN","ORWDXA",203,0)
 N NUMCHDS,NOWID,NOWVAL,X3,ORDA,ISNOW
"RTN","ORWDXA",204,0)
 Q:'$D(^OR(100,+ORID,0))
"RTN","ORWDXA",205,0)
 S ISNOW=0
"RTN","ORWDXA",206,0)
 D ISNOW^ORWDXR(.ISNOW,+ORID)
"RTN","ORWDXA",207,0)
 Q:ISNOW
"RTN","ORWDXA",208,0)
 N PKG
"RTN","ORWDXA",209,0)
 S PKG=$P($G(^OR(100,+ORID,0)),U,14)
"RTN","ORWDXA",210,0)
 S PKG=$$NMSP^ORCD(PKG)
"RTN","ORWDXA",211,0)
 I PKG'="PS" Q
"RTN","ORWDXA",212,0)
 I $L($G(^OR(100,+ORID,3))),('$L($P(^(3),U,9))) Q
"RTN","ORWDXA",213,0)
 S (NUMCHDS,NOWID,NOWVAL,X3,ORDA)=0
"RTN","ORWDXA",214,0)
 S PRTORDER=+$P(^(3),U,9)
"RTN","ORWDXA",215,0)
 S X3=$G(^OR(100,PRTORDER,3)),ORDA=$P(X3,U,7)
"RTN","ORWDXA",216,0)
 S PRTORDER=PRTORDER_";"_ORDA
"RTN","ORWDXA",217,0)
 S NUMCHDS=$P($G(^OR(100,+PRTORDER,2,0)),U,4)
"RTN","ORWDXA",218,0)
 I NUMCHDS>2 S ORY="COMPLEX-PSI"_U_PRTORDER
"RTN","ORWDXA",219,0)
 S:$D(^OR(100,+PRTORDER,4.5,"ID","NOW")) NOWID=$O(^("NOW",0))
"RTN","ORWDXA",220,0)
 S:NOWID NOWVAL=$G(^OR(100,+PRTORDER,4.5,NOWID,1))
"RTN","ORWDXA",221,0)
 I NOWVAL=1 Q
"RTN","ORWDXA",222,0)
 E  S ORY="COMPLEX-PSI"_U_PRTORDER
"RTN","ORWDXA",223,0)
 Q
"RTN","ORWDXA",224,0)
ISACTOI(ORY,OI) ; Is ord item active?
"RTN","ORWDXA",225,0)
 I $G(^ORD(101.43,+OI,.1)),^(.1)'>$$NOW^XLFDT D
"RTN","ORWDXA",226,0)
 . S ORY=$P($G(^ORD(101.43,OI,0)),U)_" has been inactivated and may not be ordered anymore."
"RTN","ORWDXA",227,0)
 Q
"RTN","ORWDXA",228,0)
UPCTCHK(ORID) ;
"RTN","ORWDXA",229,0)
 ;ORID=ORDER NUMBER
"RTN","ORWDXA",230,0)
 ;RETURNS 1 IF THERE IS AN UPCARET IN THE ORDER'S COMMENTS
"RTN","ORWDXA",231,0)
 N RET,COMMID,WPCNT,PIID S RET=0
"RTN","ORWDXA",232,0)
 S COMMID=$O(^OR(100,+ORID,4.5,"ID","COMMENT",0))
"RTN","ORWDXA",233,0)
 I COMMID S WPCNT=0 F  S WPCNT=$O(^OR(100,+ORID,4.5,COMMID,2,WPCNT)) Q:'WPCNT!(RET)  D
"RTN","ORWDXA",234,0)
 .I $G(^OR(100,+ORID,4.5,COMMID,2,WPCNT,0))["^" S RET=1
"RTN","ORWDXA",235,0)
 S PIID=$O(^OR(100,+ORID,4.5,"ID","PI",0))
"RTN","ORWDXA",236,0)
 I PIID S WPCNT=0 F  S WPCNT=$O(^OR(100,+ORID,4.5,PIID,2,WPCNT)) Q:'WPCNT!(RET)  D
"RTN","ORWDXA",237,0)
 .I $G(^OR(100,+ORID,4.5,PIID,2,WPCNT,0))["^" S RET=1
"RTN","ORWDXA",238,0)
 Q RET
"VER")
8.0^22.0
**INSTALL NAME**
PSB*3.0*79
"BLD",9065,0)
PSB*3.0*79^BAR CODE MED ADMIN^0^3150414^y
"BLD",9065,1,0)
^^1^1^3140411^
"BLD",9065,1,1,0)
See patch description for details.
"BLD",9065,4,0)
^9.64PA^^
"BLD",9065,6)
1^
"BLD",9065,6.3)
159
"BLD",9065,"ABPKG")
n
"BLD",9065,"KRN",0)
^9.67PA^779.2^20
"BLD",9065,"KRN",.4,0)
.4
"BLD",9065,"KRN",.401,0)
.401
"BLD",9065,"KRN",.402,0)
.402
"BLD",9065,"KRN",.403,0)
.403
"BLD",9065,"KRN",.5,0)
.5
"BLD",9065,"KRN",.84,0)
.84
"BLD",9065,"KRN",3.6,0)
3.6
"BLD",9065,"KRN",3.8,0)
3.8
"BLD",9065,"KRN",9.2,0)
9.2
"BLD",9065,"KRN",9.8,0)
9.8
"BLD",9065,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",9065,"KRN",9.8,"NM",1,0)
PSBML^^0^B125339367
"BLD",9065,"KRN",9.8,"NM",2,0)
PSBVPR^^0^B2149221
"BLD",9065,"KRN",9.8,"NM","B","PSBML",1)

"BLD",9065,"KRN",9.8,"NM","B","PSBVPR",2)

"BLD",9065,"KRN",19,0)
19
"BLD",9065,"KRN",19.1,0)
19.1
"BLD",9065,"KRN",101,0)
101
"BLD",9065,"KRN",101,"NM",0)
^9.68A^1^1
"BLD",9065,"KRN",101,"NM",1,0)
PSB EVSEND VPR^^0
"BLD",9065,"KRN",101,"NM","B","PSB EVSEND VPR",1)

"BLD",9065,"KRN",409.61,0)
409.61
"BLD",9065,"KRN",771,0)
771
"BLD",9065,"KRN",779.2,0)
779.2
"BLD",9065,"KRN",870,0)
870
"BLD",9065,"KRN",8989.51,0)
8989.51
"BLD",9065,"KRN",8989.52,0)
8989.52
"BLD",9065,"KRN",8994,0)
8994
"BLD",9065,"KRN","B",.4,.4)

"BLD",9065,"KRN","B",.401,.401)

"BLD",9065,"KRN","B",.402,.402)

"BLD",9065,"KRN","B",.403,.403)

"BLD",9065,"KRN","B",.5,.5)

"BLD",9065,"KRN","B",.84,.84)

"BLD",9065,"KRN","B",3.6,3.6)

"BLD",9065,"KRN","B",3.8,3.8)

"BLD",9065,"KRN","B",9.2,9.2)

"BLD",9065,"KRN","B",9.8,9.8)

"BLD",9065,"KRN","B",19,19)

"BLD",9065,"KRN","B",19.1,19.1)

"BLD",9065,"KRN","B",101,101)

"BLD",9065,"KRN","B",409.61,409.61)

"BLD",9065,"KRN","B",771,771)

"BLD",9065,"KRN","B",779.2,779.2)

"BLD",9065,"KRN","B",870,870)

"BLD",9065,"KRN","B",8989.51,8989.51)

"BLD",9065,"KRN","B",8989.52,8989.52)

"BLD",9065,"KRN","B",8994,8994)

"BLD",9065,"QUES",0)
^9.62^^
"BLD",9065,"REQB",0)
^9.611^1^1
"BLD",9065,"REQB",1,0)
PSB*3.0*70^2
"BLD",9065,"REQB","B","PSB*3.0*70",1)

"KRN",101,6090,-1)
0^1
"KRN",101,6090,0)
PSB EVSEND VPR^MEDICATION ADMINISTRATION EVENTS^^X^^^^^^^^
"KRN",101,6090,1,0)
^101.06^2^2^3140415^^
"KRN",101,6090,1,1,0)
The purpose of this protocol is to send notification of events that modify
"KRN",101,6090,1,2,0)
the BCMA MEDICATION LOG file (#53.79).
"KRN",101,6090,10,0)
^101.01PA^9^3
"KRN",101,6090,99)
63656,23225
"MBREQ")
1
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"PKG",533,-1)
1^1
"PKG",533,0)
BAR CODE MED ADMIN^PSB^BAR CODE MEDICATION ADMINISTRATION
"PKG",533,20,0)
^9.402P^^
"PKG",533,22,0)
^9.49I^1^1
"PKG",533,22,1,0)
3.0^3040224^3040329^10000000020
"PKG",533,22,1,"PAH",1,0)
79^3150414^1
"PKG",533,22,1,"PAH",1,1,0)
^^1^1^3150414
"PKG",533,22,1,"PAH",1,1,1,0)
See patch description for details.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","PSBML")
0^1^B125339367
"RTN","PSBML",1,0)
PSBML ;BIRMINGHAM/EFC-BCMA MED LOG FUNCTIONS ;10/23/12 12:14pm
"RTN","PSBML",2,0)
 ;;3.0;BAR CODE MED ADMIN;**6,3,4,9,11,13,25,45,33,52,70,79**;Mar 2004;Build 159
"RTN","PSBML",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSBML",4,0)
 ; Reference/IA
"RTN","PSBML",5,0)
 ; ^DPT/10035
"RTN","PSBML",6,0)
 ; DIC(42/10039
"RTN","PSBML",7,0)
 ; DIC(42/2440
"RTN","PSBML",8,0)
 ; File 200/10060
"RTN","PSBML",9,0)
 ; EN^PSJBCMA3/3320
"RTN","PSBML",10,0)
 ; $$SITE^VASITE/10112
"RTN","PSBML",11,0)
 ; ^XUSEC(/10076
"RTN","PSBML",12,0)
 ;
"RTN","PSBML",13,0)
 ;*70 - store clinic name to admin location if exists.
"RTN","PSBML",14,0)
 ;    - add witness duz, dt/tm for high risk/alert drug, Order level
"RTN","PSBML",15,0)
 ;      HR code, and a witnesssed y/n flag to MEDLOG file.
"RTN","PSBML",16,0)
 ;
"RTN","PSBML",17,0)
RPC(RESULTS,PSBHDR,PSBREC) ;BCMA MedLog Filing
"RTN","PSBML",18,0)
 S PSBEDTFL=0
"RTN","PSBML",19,0)
 N PSBORD,PSBTRAN,PSBFDA,PSBMES ;Add PSBMES variable for PSB*3*52
"RTN","PSBML",20,0)
 N PSBCLIN,PSBWITN,PSBWITCM,PSBWITHR,PSBWITFL,LOC                 ;*70
"RTN","PSBML",21,0)
 K PSBIEN,PSBHL7
"RTN","PSBML",22,0)
 S PSBIEN=$P(PSBHDR,U,1)
"RTN","PSBML",23,0)
 S PSBTRAN=$P(PSBHDR,U,2),PSBHL7=PSBTRAN
"RTN","PSBML",24,0)
 S PSBINST=$P($G(PSBHDR),U,3)
"RTN","PSBML",25,0)
 ;*70 witness fields
"RTN","PSBML",26,0)
 S PSBWITN=+$P(PSBHDR,U,4)                   ;init witness duz var
"RTN","PSBML",27,0)
 S PSBWITCM=$P(PSBHDR,U,5)                   ;init witness comment
"RTN","PSBML",28,0)
 S PSBWITHR=+$P(PSBHDR,U,6)                  ;init witn HR order level
"RTN","PSBML",29,0)
 S PSBWITFL=$S(PSBWITN:1,1:0)             ;init witnessed?
"RTN","PSBML",30,0)
 I PSBWITN="",PSBWITHR=3 D  Q
"RTN","PSBML",31,0)
 .S RESULTS(0)=1
"RTN","PSBML",32,0)
 .S RESULTS(1)="-1^A Witness is required, however Witness information was null."
"RTN","PSBML",33,0)
 ;PSB*3*45 We should be recording the first entry in the audit log.
"RTN","PSBML",34,0)
 ;S PSBAUDIT=$S(PSBIEN="+1":0,1:1)
"RTN","PSBML",35,0)
 S PSBAUDIT=1
"RTN","PSBML",36,0)
 D NOW^%DTC S PSBNOW=%
"RTN","PSBML",37,0)
 I $D(^XUSEC("PSB STUDENT",DUZ)),PSBINST="" S RESULTS(0)=1,RESULTS(1)="-1^Instructor not present" Q
"RTN","PSBML",38,0)
 I $D(^XUSEC("PSB STUDENT",DUZ)),'$D(^XUSEC("PSB INSTRUCTOR",PSBINST)) S RESULTS(0)=1,RESULTS(1)="-1^Instructor doesn't have authority" Q
"RTN","PSBML",39,0)
 S PSBINST(0)=$$GET1^DIQ(200,PSBINST_",",.01)
"RTN","PSBML",40,0)
 I PSBTRAN="ADD COMMENT" D COMMENT^PSBML1 Q
"RTN","PSBML",41,0)
 I PSBTRAN="PRN EFFECTIVENESS" D PRN^PSBML1 Q
"RTN","PSBML",42,0)
 ;
"RTN","PSBML",43,0)
 ;update medlog rec
"RTN","PSBML",44,0)
UPD I PSBTRAN="UPDATE STATUS" D  Q
"RTN","PSBML",45,0)
 .I '$D(^PSB(53.79,PSBIEN)) D  Q
"RTN","PSBML",46,0)
 ..S RESULTS(0)=1
"RTN","PSBML",47,0)
 ..S RESULTS(1)="-1^Administration is at an UNKNOWN STATUS"
"RTN","PSBML",48,0)
 .D UPDATED^PSBML2
"RTN","PSBML",49,0)
 ;
"RTN","PSBML",50,0)
 ;edit Medlog rec
"RTN","PSBML",51,0)
 I PSBTRAN="EDIT" D EDIT^PSBML2 Q
"RTN","PSBML",52,0)
 ;
"RTN","PSBML",53,0)
 ;SAGG
"RTN","PSBML",54,0)
 N PSBWARD S PSBWARD=$G(^DPT(+$G(PSBREC(0)),.1),"UNKNOWN"),^PSB("SAGG",PSBWARD,DT)=$G(^PSB("SAGG",PSBWARD,DT))+1
"RTN","PSBML",55,0)
 ;*70 save clinic name if exists before manipulating PSBREC(1) param
"RTN","PSBML",56,0)
 S PSBCLIN=$P(PSBREC(1),U,2) I PSBCLIN="" S PSBCLIN=$S($G(PSBCLIEN):$P($G(^SC(+PSBCLIEN,0)),"^"),($G(PSBCLORD)]""):PSBCLORD,1:"")
"RTN","PSBML",57,0)
 S PSBREC(1)=$P(PSBREC(1),U)
"RTN","PSBML",58,0)
 ;
"RTN","PSBML",59,0)
 ;pre-existing psbrec(1) manipulation logic to *70
"RTN","PSBML",60,0)
 I PSBREC(1)?1U1";"1.6N S PSBREC(1)=$P(PSBREC(1),";",1)_$E(PSBREC(1))
"RTN","PSBML",61,0)
 D PSJ1^PSBVT(PSBREC(0),$P(PSBREC(1),";",2)_$P(PSBREC(1),";",1))
"RTN","PSBML",62,0)
 S PSBTAB=$P(PSBREC(9),U,1),PSBUID=$P(PSBREC(9),U,2)
"RTN","PSBML",63,0)
MEDP D:PSBTRAN="MEDPASS"
"RTN","PSBML",64,0)
 .I (PSBDOSEF["PATCH"),(PSBREC(3)="G") D  Q:+$G(RESULTS(1))<0
"RTN","PSBML",65,0)
 ..S PSBXDT="" F  S PSBXDT=$O(^PSB(53.79,"AORDX",PSBDFN,PSBONX,PSBXDT)) Q:PSBXDT=""  D  Q:+$G(RESULTS(1))<0
"RTN","PSBML",66,0)
 ...S PSBYZ="" F  S PSBYZ=$O(^PSB(53.79,"AORDX",PSBDFN,PSBONX,PSBXDT,PSBYZ)) Q:'PSBYZ  I ("G"[$$GET1^DIQ(53.79,PSBYZ,.09,"I")) D  Q
"RTN","PSBML",67,0)
 ....S:($$GET1^DIQ(53.79,PSBYZ,.09,"I")="G") RESULTS(0)=1,RESULTS(1)="-1^Previous Patch has not been removed. Administration canceled."
"RTN","PSBML",68,0)
 ....S:($$GET1^DIQ(53.79,PSBYZ,.09,"I")="")&(($$GET1^DIQ(53.79,PSBYZ,.07,"I")'=DUZ)&('$D(^XUSEC("PSB MANAGER",DUZ)))) RESULTS(0)=1,RESULTS(1)="-1^Patch status ""*UNKNOWN*"". Administration canceled."
"RTN","PSBML",69,0)
 .I PSBREC(7)="BCMA/CPRS Interface Entry." S PSBNOW=PSBREC(5)  ;MOB
"RTN","PSBML",70,0)
 .F X=0:1:9 S PSBREC(X)=$G(PSBREC(X))
"RTN","PSBML",71,0)
 .I PSBREC(1)?1U1";".N S PSBREC(1)=$P(PSBREC(1),";",2)_$P(PSBREC(1),";",1)
"RTN","PSBML",72,0)
 .I PSBREC(1)["V",+PSBREC(5)>0,+$P(PSBREC(5),".",2)=0,PSBIVT'["P" D NOW^%DTC S PSBREC(5)=$P(PSBREC(5),".",1)_"."_$P(%,".",2)
"RTN","PSBML",73,0)
 .I $P(PSBREC(9),U,1)="IVTAB",$P(PSBREC(9),U,2)="" S PSBUID=$$GETWSID^PSBVDLU2(PSBREC(0),PSBREC(1))
"RTN","PSBML",74,0)
 .I $P(PSBREC(9),U,1)="PBTAB",$P(PSBREC(9),U,2)="",PSBREC(1)'["U",PSBREC(3)'="M",PSBREC(3)'="R",PSBREC(3)'="H" S PSBUID=$$GETWSID^PSBVDLU2(PSBREC(0),PSBREC(1))
"RTN","PSBML",75,0)
 .;OnCal
"RTN","PSBML",76,0)
 .D:PSBREC(2)="OC"
"RTN","PSBML",77,0)
 ..S X=$O(^PSB(53.79,"AORD",PSBREC(0),PSBREC(1),"")) Q:X=""
"RTN","PSBML",78,0)
 ..S Y=$O(^PSB(53.79,"AORD",PSBREC(0),PSBREC(1),X,0))
"RTN","PSBML",79,0)
 ..I $P(^PSB(53.79,Y,0),U,9)="G"&('$$GET^XPAR("DIV","PSB ADMIN MULTIPLE ONCALL")) D ERR(1,"On-Call already given")
"RTN","PSBML",80,0)
 .;1x
"RTN","PSBML",81,0)
 .D:PSBREC(2)="O"
"RTN","PSBML",82,0)
 ..S X=$O(^PSB(53.79,"AORD",PSBREC(0),PSBREC(1),"")) Q:X=""
"RTN","PSBML",83,0)
 ..S Y=$O(^PSB(53.79,"AORD",PSBREC(0),PSBREC(1),X,0))
"RTN","PSBML",84,0)
 ..I $P(^PSB(53.79,Y,0),U,9)="G" D ERR(1,"One Time already Given")
"RTN","PSBML",85,0)
 .;PRN
"RTN","PSBML",86,0)
 .I PSBREC(2)="P",PSBREC(3)'="M",$P(PSBREC(9),U,1)'="IVTAB" D
"RTN","PSBML",87,0)
 ..I PSBREC(6)="" D ERR(1,"PRN Medications MUST Have a PRN Reason")
"RTN","PSBML",88,0)
 ..I PSBREC(5)]"" D ERR(1,"PRN Orders don't have scheduled times")
"RTN","PSBML",89,0)
 ..I PSBREC(3)'="G" D ERR(1,"PRN Orders cannot be marked NOT Given")
"RTN","PSBML",90,0)
 .;Cnt
"RTN","PSBML",91,0)
 .I PSBREC(2)="C",PSBTAB'="IVTAB" D
"RTN","PSBML",92,0)
 ..D:PSBREC(5)="" ERR(1,"Continuous Order needs admin time")
"RTN","PSBML",93,0)
 ..D:PSBREC(6)]"" ERR(1,"No PRN Reason allowed on Continuous Orders")
"RTN","PSBML",94,0)
 .I PSBREC(2)="C",$D(^PSB(53.79,"AORD",PSBREC(0),PSBREC(1),+PSBREC(5))),PSBIEN="+1" D  K PSBADMBY,PSBADMAT Q:PSBSIEN=""  Q:$P(^PSB(53.79,PSBSIEN,0),U,9)'="N"
"RTN","PSBML",95,0)
 ..S PSBSIEN=$O(^PSB(53.79,"AORD",PSBREC(0),PSBREC(1),PSBREC(5),""))
"RTN","PSBML",96,0)
 ..I PSBSIEN]"" I '(($P(^PSB(53.79,PSBSIEN,0),U,7)=DUZ)!($D(^XUSEC("PSB MANAGER",DUZ)))) S PSBSIEN=""
"RTN","PSBML",97,0)
 ..I PSBSIEN']"" S RESULTS(0)=2,RESULTS(1)="-2^Error Filing Transaction MEDPASS",RESULTS(2)="The PSB MANAGER key is required to modify this scheduled admin" Q
"RTN","PSBML",98,0)
 ..D:$P(^PSB(53.79,PSBSIEN,0),U,9)'="N"
"RTN","PSBML",99,0)
 ...K PSBINCX I $P(^PSB(53.79,PSBSIEN,0),U,9)="" S PSBINCX=PSBSIEN L +^PSB(53.79,PSBINCX):1 Q:'$T  L -^PSB(53.79,PSBINCX)
"RTN","PSBML",100,0)
 ...S Y=$P(^PSB(53.79,PSBSIEN,0),U,6) D DD^%DT S PSBADMAT=Y
"RTN","PSBML",101,0)
 ...S PSBADMBY=$$GET1^DIQ(200,$P(^PSB(53.79,PSBSIEN,0),U,7),.01,)
"RTN","PSBML",102,0)
 ...S RESULTS(0)=3,RESULTS(1)="-2^Error Filing Transaction MEDPASS"
"RTN","PSBML",103,0)
 ...S RESULTS(2)="Continuous Administration Date/Time already on file."
"RTN","PSBML",104,0)
 ...S RESULTS(3)="Administered by "_PSBADMBY_" at "_PSBADMAT_"."
"RTN","PSBML",105,0)
 ...I $D(XWB) S RESULTS(0)=RESULTS(0)+2,RESULTS(4)="                                         ",RESULTS(5)="            VDL will now be updated."
"RTN","PSBML",106,0)
 .;Non Given
"RTN","PSBML",107,0)
 .I PSBREC(3)'="G",PSBREC(3)'="M",PSBUID'["V",PSBUID'["W" D
"RTN","PSBML",108,0)
 ..I PSBREC(7)="",PSBTAB'="IVTAB" D ERR(1,"Comment needed if Not Marked Given")
"RTN","PSBML",109,0)
 ..I PSBREC(7)="",PSBTAB="IVTAB" D ERR(1,"Comment needed if Not Marked Completed")
"RTN","PSBML",110,0)
 .S:PSBREC(3)="H" PSBREC(7)="Held: "_PSBREC(7)    ;.3
"RTN","PSBML",111,0)
 .S:PSBREC(3)="R" PSBREC(7)="Refused: "_PSBREC(7) ;.3
"RTN","PSBML",112,0)
 .S:PSBREC(3)="S" PSBREC(7)="Stopped: "_PSBREC(7) ;.3
"RTN","PSBML",113,0)
 .;Valid?
"RTN","PSBML",114,0)
 .I $G(PSBSIEN)'="" I $D(^PSB(53.79,PSBSIEN,0)) I $P(^PSB(53.79,PSBSIEN,0),U,9)="N" S PSBIEN=+PSBSIEN_",",$P(PSBHDR,U)=PSBIEN,PSBTRAN="UPDATE STATUS",PSBAUDIT=1                   ;do UPDATE
"RTN","PSBML",115,0)
 .D:PSBIEN="+1"                          ;New fields only?
"RTN","PSBML",116,0)
 ..D VAL(53.79,PSBIEN,.01,"`"_PSBREC(0))           ;Patn
"RTN","PSBML",117,0)
 ..S LOC=$G(^DPT(PSBREC(0),.1))_" "_$G(^(.101))    ;Ward Room/Bed LOC
"RTN","PSBML",118,0)
 ..S:PSBCLIN]"" LOC=PSBCLIN         ;If clinic order use clin name *70
"RTN","PSBML",119,0)
 ..D VAL(53.79,PSBIEN,.02,LOC)                     ;Patn Location LOC
"RTN","PSBML",120,0)
 ..D:$G(^DPT(PSBREC(0),.1))'=""
"RTN","PSBML",121,0)
 ...S Y=$O(^DIC(42,"B",$G(^DPT(PSBREC(0),.1)),"")),Y=$$GET1^DIQ(42,Y,.015,"I"),PSBDIV=$$SITE^VASITE(DT,Y)
"RTN","PSBML",122,0)
 ...D VAL(53.79,PSBIEN,.03,"`"_$P(PSBDIV,U,1))     ;Div
"RTN","PSBML",123,0)
 ..D VAL(53.79,PSBIEN,.04,PSBNOW)                  ;Entered dt/tm
"RTN","PSBML",124,0)
 ..D VAL(53.79,PSBIEN,.05,"`"_DUZ)                 ;Entered by duz
"RTN","PSBML",125,0)
 ..D VAL(53.79,PSBIEN,.06,PSBNOW)                  ;Admin dt/tm
"RTN","PSBML",126,0)
 ..D VAL(53.79,PSBIEN,.07,"`"_DUZ)                 ;Admin By duz
"RTN","PSBML",127,0)
 ..D VAL(53.79,PSBIEN,.08,"`"_PSBREC(4))           ;Orderable Item
"RTN","PSBML",128,0)
 ..D VAL(53.79,PSBIEN,.11,PSBREC(1))               ;Ord file 55 IEN
"RTN","PSBML",129,0)
 ..D VAL(53.79,PSBIEN,.12,PSBREC(2))               ;Ord Schd Type
"RTN","PSBML",130,0)
 ..D VAL(53.79,PSBIEN,.13,PSBREC(5))               ;Schd Adm dt/tm
"RTN","PSBML",131,0)
 ..D:PSBTAB'="UDTAB" VAL(53.79,PSBIEN,.26,PSBUID)  ;IV Bag ID
"RTN","PSBML",132,0)
 ..D:PSBTAB="IVTAB" VAL(53.79,PSBIEN,.13,"")       ;Schd Admdt/tm null
"RTN","PSBML",133,0)
 ..D:PSBREC(1)?.N1"U" VAL(53.79,PSBIEN,.15,PSBDOSE)  ;UD Dosage
"RTN","PSBML",134,0)
 ..D:PSBREC(1)?.N1"V" VAL(53.79,PSBIEN,.35,PSBIFR)   ;IV Infuse Rate
"RTN","PSBML",135,0)
 ..I PSBWITHR>1,(PSBREC(3)="G")!(PSBREC(3)="I") D          ;Witness logic and Give?  *70
"RTN","PSBML",136,0)
 ...D:PSBWITN VAL(53.79,PSBIEN,.28,PSBNOW)        ;Witness dt/time
"RTN","PSBML",137,0)
 ...D:PSBWITN VAL(53.79,PSBIEN,.29,"`"_PSBWITN)   ;Witness duz
"RTN","PSBML",138,0)
 ...D:PSBWITCM]"" VAL(53.79,PSBIEN,.31,PSBWITCM)  ;Witness comment
"RTN","PSBML",139,0)
 ...D VAL(53.79,PSBIEN,.32,PSBWITHR)              ;Witness HR ord code
"RTN","PSBML",140,0)
 ...D VAL(53.79,PSBIEN,.33,PSBWITFL)              ;Witnessed? flag
"RTN","PSBML",141,0)
 .;
"RTN","PSBML",142,0)
 .;Overwrite fields below, rec already exsts
"RTN","PSBML",143,0)
 .I PSBREC(3)="G"!(PSBREC(3))="C" D                ;Gvn/Completed?
"RTN","PSBML",144,0)
 ..D VAL(53.79,PSBIEN,.06,PSBNOW)                    ;Admin dt/tm
"RTN","PSBML",145,0)
 ..D VAL(53.79,PSBIEN,.07,"`"_DUZ)                   ;Admin By duz
"RTN","PSBML",146,0)
 .D:PSBREC(8)]"" VAL(53.79,PSBIEN,.16,PSBREC(8))   ;InjctSte
"RTN","PSBML",147,0)
 .D:'$G(PSBMMEN) VAL(53.79,PSBIEN,.09,PSBREC(3))   ;AStats
"RTN","PSBML",148,0)
 .I PSBREC(6)]"" D                                 ;PRN reason?
"RTN","PSBML",149,0)
 ..D VAL(53.79,PSBIEN,.21,$P(PSBREC(6),U))           ;reason dt/tm
"RTN","PSBML",150,0)
 ..D VAL(53.79,PSBIEN,.27,$P(PSBREC(6),U,2))         ;PRN reason
"RTN","PSBML",151,0)
 .D:PSBREC(7)]""
"RTN","PSBML",152,0)
 ..D VAL(53.793,"+2,"_PSBIEN,.01,PSBREC(7))        ;Comment
"RTN","PSBML",153,0)
 ..D VAL(53.793,"+2,"_PSBIEN,.02,"`"_DUZ)          ;comnt person duz
"RTN","PSBML",154,0)
 ..D VAL(53.793,"+2,"_PSBIEN,.03,PSBNOW)           ;comnt dt/time
"RTN","PSBML",155,0)
 .;DD/SOL/ADD
"RTN","PSBML",156,0)
 .I PSBREC(3)="G"!(PSBREC(3)="I")!(PSBREC(3)="H")!(PSBREC(3)="R")!(PSBREC(3)="M") D     ;given/action stat codes?
"RTN","PSBML",157,0)
 ..I PSBTRAN="UPDATE STATUS" K ^PSB(53.79,+PSBIEN,.5),^PSB(53.79,+PSBIEN,.6),^PSB(53.79,+PSBIEN,.7)
"RTN","PSBML",158,0)
 ..F PSBCNT=10:1 Q:'$D(PSBREC(PSBCNT))  D
"RTN","PSBML",159,0)
 ...S Y=$P(PSBREC(PSBCNT),U)
"RTN","PSBML",160,0)
 ...S PSBDD=$S(Y="DD":53.795,Y="ADD":53.796,Y="SOL":53.797,1:0)
"RTN","PSBML",161,0)
 ...Q:'PSBDD
"RTN","PSBML",162,0)
 ...S PSBIENS="+"_PSBCNT_","_PSBIEN
"RTN","PSBML",163,0)
 ...D VAL(PSBDD,PSBIENS,.01,"`"_$P(PSBREC(PSBCNT),U,2))
"RTN","PSBML",164,0)
 ...D VAL(PSBDD,PSBIENS,.02,$P(PSBREC(PSBCNT),U,3))
"RTN","PSBML",165,0)
 ...D VAL(PSBDD,PSBIENS,.03,$P(PSBREC(PSBCNT),U,4))
"RTN","PSBML",166,0)
 ...D:(PSBTAB="UDTAB")!(PSBTAB="PBTAB") VAL(PSBDD,PSBIENS,.04,$E($P(PSBREC(PSBCNT),U,5),1,40))
"RTN","PSBML",167,0)
 ...D VAL(PSBDD,PSBIENS,.05,$P(PSBREC(PSBCNT),U,7))        ;HR ind *70
"RTN","PSBML",168,0)
 .;Modify Filing Transaction Medpass error message too inclde details - PSB*3*52
"RTN","PSBML",169,0)
 .I $O(RESULTS("")) D  Q
"RTN","PSBML",170,0)
 ..N PSBERR
"RTN","PSBML",171,0)
 ..I $D(PSBMES) D
"RTN","PSBML",172,0)
 ...S RESULTS(1)="-2^***Your documentation is NOT being recorded in the patient record.***",RESULTS(2)=""
"RTN","PSBML",173,0)
 ...S RESULTS(3)="Please write down the information (below) AND contact your BCMA Coordinator or IT Support for assistance:",RESULTS(4)=""
"RTN","PSBML",174,0)
 ...S RESULTS(5)="Error(s) Filing Transaction MEDPASS"
"RTN","PSBML",175,0)
 ..S PSBERR=0 F  S PSBERR=$O(PSBMES(PSBERR)) Q:PSBERR=""  D
"RTN","PSBML",176,0)
 ...S RESULTS($O(RESULTS(""),-1)+1)=PSBMES(PSBERR),RESULTS(0)=$O(RESULTS(""),-1)
"RTN","PSBML",177,0)
 .;
"RTN","PSBML",178,0)
 .D FILEIT
"RTN","PSBML",179,0)
 .;
"RTN","PSBML",180,0)
 .;PSB*3*33
"RTN","PSBML",181,0)
 .D:((PSBREC(2)="O")!($$ONE^PSJBCMA(PSBREC(0),PSBREC(1))="O"))&(PSBREC(3)="G") EXPIRE^PSBML1  ;1x exp?
"RTN","PSBML",182,0)
 .D:(PSBREC(2)="O")&(PSBREC(3)="G") EXPIRE^PSBML1  ;1x exp?
"RTN","PSBML",183,0)
 .I $P(RESULTS(0),U,1)=1,PSBTAB'="UDTAB",PSBUID]"",PSBUID'["WS" S PSBON=+PSBREC(1) D EN^PSJBCMA3(PSBREC(0),PSBON,PSBUID,PSBREC(3),PSBNOW)
"RTN","PSBML",184,0)
 Q
"RTN","PSBML",185,0)
BCBU ;HL7,NatContng
"RTN","PSBML",186,0)
 Q:+$G(RESULTS(0))'>0
"RTN","PSBML",187,0)
 N PSBIEN1 S PSBIEN1=$S($P(PSBIEN,",",2)'="":+$P(PSBIEN,",",2),$G(PSBIEN)="+1":PSBIEN(1),1:+$G(PSBIEN))
"RTN","PSBML",188,0)
 I $G(PSBIEN1)="" S RESULTS(0)=1,RESULTS(1)="-1^Contingency NOT processed" Q
"RTN","PSBML",189,0)
 I $G(PSBIEN)="+1" S PSBHL7="MEDPASS"
"RTN","PSBML",190,0)
 E  S:$G(PSBHL7)="" PSBHL7="UPDATE STATUS"
"RTN","PSBML",191,0)
 D:('$D(Y(0))!($G(Y(0))="SAVE")!($G(Y(0))="YES")) EN^PSBSVHL7(+PSBIEN1,PSBHL7),MEDL^ALPBCBU(+PSBIEN1) K PSBHL7
"RTN","PSBML",192,0)
 ;<<HDR-VDEF(frm *3)
"RTN","PSBML",193,0)
 Q
"RTN","PSBML",194,0)
VAL(PSBDD,PSBIEN,PSBFLD,PSBVAL) ;
"RTN","PSBML",195,0)
 K ^TMP("DIERR",$J),PSBRET
"RTN","PSBML",196,0)
 D VAL^DIE(PSBDD,PSBIEN,PSBFLD,"F",PSBVAL,.PSBRET,"PSBFDA")
"RTN","PSBML",197,0)
 I PSBRET="^" F X=0:0 S X=$O(^TMP("DIERR",$J,X)) Q:'X  D ERR(2,^TMP("DIERR",$J,X)_": "_$G(^(X,"TEXT",1),"**"))
"RTN","PSBML",198,0)
 K ^TMP("DIERR",$J),PSBRET
"RTN","PSBML",199,0)
 Q
"RTN","PSBML",200,0)
FILEIT ;Updt
"RTN","PSBML",201,0)
 N PSBMSG,PSBAUD
"RTN","PSBML",202,0)
 S (PSB1,PSB2)=""
"RTN","PSBML",203,0)
 D APATCH^PSBML3
"RTN","PSBML",204,0)
 D CLEAN^DILF
"RTN","PSBML",205,0)
 D RESETADM^PSBUTL
"RTN","PSBML",206,0)
 D UPDATE^DIE("","PSBFDA","PSBIEN","PSBMSG")
"RTN","PSBML",207,0)
 I '$G(PSBMMEN) S X=+PSBIEN I $F("HR",$P(^PSB(53.79,X,0),U,9))>1 F Y=.5,.6,.7 S Z=0 F  S Z=$O(^PSB(53.79,+X,Y,Z)) Q:+Z=0  S $P(^PSB(53.79,+X,Y,Z,0),U,3)=0
"RTN","PSBML",208,0)
 I $D(PSBMSG("DIERR")) S RESULTS(0)=1,RESULTS(1)="-1^"_PSBMSG("DIERR",1)_": "_PSBMSG("DIERR",1,"TEXT",1)  Q
"RTN","PSBML",209,0)
 I $G(PSB1)]"" X PSB1 I $G(PSB2)]"" X PSB2
"RTN","PSBML",210,0)
 I $D(PSBHDR) D:"NHMR"[$P(^PSB(53.79,$S($P(PSBHDR,"^",1)="+1":PSBIEN(1),1:+PSBIEN),0),U,9)
"RTN","PSBML",211,0)
 .N PSBINDX S PSBINDX=$S($P(PSBHDR,"^",1)="+1":PSBIEN(1),1:+PSBIEN)
"RTN","PSBML",212,0)
 .K ^PSB(53.79,"APATCH",$P(^PSB(53.79,PSBINDX,0),U),$P(^PSB(53.79,PSBINDX,0),U,6),PSBINDX)
"RTN","PSBML",213,0)
 S RESULTS(0)=1,RESULTS(1)="1^Data Successfully Filed^"_$S($G(PSBIEN(1))'="":$G(PSBIEN(1)),1:+$G(PSBIEN))
"RTN","PSBML",214,0)
 D BCBU  ;NatContng
"RTN","PSBML",215,0)
 D  ;
"RTN","PSBML",216,0)
 . N X,DIC
"RTN","PSBML",217,0)
 . S X="PSB EVSEND VPR",DIC=101 D EN^XQOR ;should handle all BCMA Med Log events for VPR
"RTN","PSBML",218,0)
 I $G(PSBINST,0) S PSBAUD=$S($P(PSBHDR,"^",1)="+1":PSBIEN(1),1:$P(PSBHDR,"^",1)) D AUDIT^PSBMLU(PSBAUD,"Instructor "_PSBINST(0)_" present.",PSBTRAN)
"RTN","PSBML",219,0)
 Q
"RTN","PSBML",220,0)
ERR(X,Y) ;
"RTN","PSBML",221,0)
 S X=$P("Business Logic Error^Data Validation Error",U,X)
"RTN","PSBML",222,0)
 S RESULTS($O(RESULTS(""),-1)+1)=X_": "_Y
"RTN","PSBML",223,0)
 S PSBMES($O(PSBMES(""),-1)+1)=X_": "_Y
"RTN","PSBML",224,0)
 Q
"RTN","PSBML",225,0)
COMMENT(DA,PSBCMT) ;
"RTN","PSBML",226,0)
 N PSBFDA,PSBIEN,PSBNOW
"RTN","PSBML",227,0)
 S PSBIEN="+1,"_DA_","
"RTN","PSBML",228,0)
 D NOW^%DTC S PSBNOW=%
"RTN","PSBML",229,0)
 D VAL(53.793,PSBIEN,.01,PSBCMT)
"RTN","PSBML",230,0)
 S PSBFDA(53.793,PSBIEN,.02)=DUZ
"RTN","PSBML",231,0)
 S PSBFDA(53.793,PSBIEN,.03)=PSBNOW
"RTN","PSBML",232,0)
 D FILEIT
"RTN","PSBML",233,0)
 Q
"RTN","PSBVPR")
0^2^B2149221
"RTN","PSBVPR",1,0)
PSBVPR ;SLC/JLC- BCMA-VPR UTILITIES ;11/15/12 2:40pm
"RTN","PSBVPR",2,0)
 ;;3.0;BAR CODE MED ADMIN;**79**;Mar 2004;Build 159
"RTN","PSBVPR",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBVPR",4,0)
 ;
"RTN","PSBVPR",5,0)
 ;
"RTN","PSBVPR",6,0)
ADMIN(RESULTS,PSBVDFN,PSBORDNO,PSBVADT) ;
"RTN","PSBVPR",7,0)
 I $G(PSBVDFN)="" Q -1
"RTN","PSBVPR",8,0)
 I $G(PSBORDNO)="" Q -2
"RTN","PSBVPR",9,0)
 K ^TMP("PSB",$J) N PSBI,A,PSBA,S1,X1,X2,X
"RTN","PSBVPR",10,0)
 I '$G(PSBVADT) D NOW^%DTC S PSBVADT=%
"RTN","PSBVPR",11,0)
 D GETINFO
"RTN","PSBVPR",12,0)
 S RESULTS=$O(PSBA(PSBVADT-.0001)) I 'RESULTS S X1=PSBVADT,X2=1 D C^%DTC S PSBVADT=X D GETINFO
"RTN","PSBVPR",13,0)
 S RESULTS=$O(PSBA(PSBVADT-.0001))
"RTN","PSBVPR",14,0)
 Q
"RTN","PSBVPR",15,0)
GETINFO ;
"RTN","PSBVPR",16,0)
 I PSBORDNO?.E1"U" D RPC^PSBVDLTB(,PSBVDFN,"UDTAB",PSBVADT) M ^TMP("PSBVPR",$J)=^TMP("PSB",$J,"UDTAB")
"RTN","PSBVPR",17,0)
 I PSBORDNO?.E1"V" F PSBI="IVTAB","PBTAB" D RPC^PSBVDLTB(,PSBVDFN,PSBI,$G(PSBVADT)) M ^TMP("PSBVPR",$J)=^TMP("PSB",$J,PSBI)
"RTN","PSBVPR",18,0)
 S S1=0 F  S S1=$O(^TMP("PSBVPR",$J,S1)) Q:'S1  D
"RTN","PSBVPR",19,0)
 . S A=^TMP("PSBVPR",$J,S1) I $P(A,"^")'=PSBVDFN Q
"RTN","PSBVPR",20,0)
 . I $P(A,"^",2)'=PSBORDNO Q
"RTN","PSBVPR",21,0)
 . S PSBA($P(A,"^",14))=""
"RTN","PSBVPR",22,0)
 Q
"VER")
8.0^22.0
**INSTALL NAME**
TIU*1.0*106
"BLD",9067,0)
TIU*1.0*106^TEXT INTEGRATION UTILITIES^0^3150414^y
"BLD",9067,4,0)
^9.64PA^^
"BLD",9067,6.3)
315
"BLD",9067,"INID")
^n
"BLD",9067,"INIT")
MAIN^TIUPS106
"BLD",9067,"KRN",0)
^9.67PA^779.2^20
"BLD",9067,"KRN",.4,0)
.4
"BLD",9067,"KRN",.401,0)
.401
"BLD",9067,"KRN",.402,0)
.402
"BLD",9067,"KRN",.403,0)
.403
"BLD",9067,"KRN",.5,0)
.5
"BLD",9067,"KRN",.84,0)
.84
"BLD",9067,"KRN",3.6,0)
3.6
"BLD",9067,"KRN",3.8,0)
3.8
"BLD",9067,"KRN",9.2,0)
9.2
"BLD",9067,"KRN",9.8,0)
9.8
"BLD",9067,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",9067,"KRN",9.8,"NM",1,0)
TIUPS106^^0^B3190064
"BLD",9067,"KRN",9.8,"NM",2,0)
TIUVPR^^0^B10950606
"BLD",9067,"KRN",9.8,"NM",3,0)
TIUDDX^^0^B222239
"BLD",9067,"KRN",9.8,"NM","B","TIUDDX",3)

"BLD",9067,"KRN",9.8,"NM","B","TIUPS106",1)

"BLD",9067,"KRN",9.8,"NM","B","TIUVPR",2)

"BLD",9067,"KRN",19,0)
19
"BLD",9067,"KRN",19.1,0)
19.1
"BLD",9067,"KRN",101,0)
101
"BLD",9067,"KRN",409.61,0)
409.61
"BLD",9067,"KRN",771,0)
771
"BLD",9067,"KRN",779.2,0)
779.2
"BLD",9067,"KRN",870,0)
870
"BLD",9067,"KRN",8989.51,0)
8989.51
"BLD",9067,"KRN",8989.52,0)
8989.52
"BLD",9067,"KRN",8994,0)
8994
"BLD",9067,"KRN","B",.4,.4)

"BLD",9067,"KRN","B",.401,.401)

"BLD",9067,"KRN","B",.402,.402)

"BLD",9067,"KRN","B",.403,.403)

"BLD",9067,"KRN","B",.5,.5)

"BLD",9067,"KRN","B",.84,.84)

"BLD",9067,"KRN","B",3.6,3.6)

"BLD",9067,"KRN","B",3.8,3.8)

"BLD",9067,"KRN","B",9.2,9.2)

"BLD",9067,"KRN","B",9.8,9.8)

"BLD",9067,"KRN","B",19,19)

"BLD",9067,"KRN","B",19.1,19.1)

"BLD",9067,"KRN","B",101,101)

"BLD",9067,"KRN","B",409.61,409.61)

"BLD",9067,"KRN","B",771,771)

"BLD",9067,"KRN","B",779.2,779.2)

"BLD",9067,"KRN","B",870,870)

"BLD",9067,"KRN","B",8989.51,8989.51)

"BLD",9067,"KRN","B",8989.52,8989.52)

"BLD",9067,"KRN","B",8994,8994)

"BLD",9067,"QUES",0)
^9.62^^
"BLD",9067,"REQB",0)
^9.611^^
"INIT")
MAIN^TIUPS106
"MBREQ")
1
"PKG",516,-1)
1^1
"PKG",516,0)
TEXT INTEGRATION UTILITIES^TIU^Text Integration Utilities 
"PKG",516,20,0)
^9.402P^^
"PKG",516,22,0)
^9.49I^1^1
"PKG",516,22,1,0)
1.0^2970620^2970815^11712
"PKG",516,22,1,"PAH",1,0)
106^3150414^1
"PKG",516,22,1,"PAH",1,1,0)
^^1^1^3150414
"PKG",516,22,1,"PAH",1,1,1,0)
Support for VPR
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","TIUDDX")
0^3^B222239
"RTN","TIUDDX",1,0)
TIUDDX ; SLC/MKB - Event Cross-references
"RTN","TIUDDX",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**106**;Jun 20, 1997;Build 315
"RTN","TIUDDX",3,0)
 ;
"RTN","TIUDDX",4,0)
 ; Set/Kill Logic to broadcast updates to TIU Document file
"RTN","TIUDDX",5,0)
 ;
"RTN","TIUDDX",6,0)
 ; No cross reference nodes are set or killed.
"RTN","TIUDDX",7,0)
 ; Subscribers must read-only the DA, X arrays provided by FileMan.
"RTN","TIUDDX",8,0)
 ;
"RTN","TIUDDX",9,0)
DOC ; -- AEVT index on #8925
"RTN","TIUDDX",10,0)
 N DFN S DFN=$G(X(12))
"RTN","TIUDDX",11,0)
 D:$L($T(TIU^VPREVNT)) TIU^VPREVNT(DFN,DA)
"RTN","TIUDDX",12,0)
 D:$L($T(TIU^HMPEVNT)) TIU^HMPEVNT(DFN,DA)
"RTN","TIUDDX",13,0)
 Q
"RTN","TIUPS106")
0^1^B3190064
"RTN","TIUPS106",1,0)
TIUPS106 ; SLC/JER,MKB - post install for 106 ;14-MAY-2004 [9/21/04 1:07pm]
"RTN","TIUPS106",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**106**;Jun 20, 1997;Build 315
"RTN","TIUPS106",3,0)
 ;
"RTN","TIUPS106",4,0)
MAIN ;controls branching
"RTN","TIUPS106",5,0)
 D NEWXREF
"RTN","TIUPS106",6,0)
 Q
"RTN","TIUPS106",7,0)
 ;
"RTN","TIUPS106",8,0)
NEWXREF ;creates new index "AEVT" on Documents file #8925
"RTN","TIUPS106",9,0)
 D DELIXN^DDMOD(8925,"AVPR","W")
"RTN","TIUPS106",10,0)
 N TIUARR,TIURES
"RTN","TIUPS106",11,0)
 S TIUARR("FILE")=8925
"RTN","TIUPS106",12,0)
 S TIUARR("NAME")="AEVT"
"RTN","TIUPS106",13,0)
 S TIUARR("TYPE")="MU"
"RTN","TIUPS106",14,0)
 S TIUARR("USE")="A"
"RTN","TIUPS106",15,0)
 S TIUARR("EXECUTION")="R"
"RTN","TIUPS106",16,0)
 S TIUARR("ACTIVITY")="R"
"RTN","TIUPS106",17,0)
 S TIUARR("SET CONDITION")="S X=(X2(12)'="""")" ;Patient defined
"RTN","TIUPS106",18,0)
 S TIUARR("KILL CONDITION")="S X=(X2(1)="""")" ;Document type deleted
"RTN","TIUPS106",19,0)
 S TIUARR("SET")="D DOC^TIUDDX"
"RTN","TIUPS106",20,0)
 S TIUARR("KILL")="D DOC^TIUDDX"
"RTN","TIUPS106",21,0)
 S TIUARR("SHORT DESCR")="Data Update Event"
"RTN","TIUPS106",22,0)
 S TIUARR("DESCR",1)="This is an action index that broadcasts when any of the fields"
"RTN","TIUPS106",23,0)
 S TIUARR("DESCR",2)="in this index are changed. No actual cross-reference nodes are"
"RTN","TIUPS106",24,0)
 S TIUARR("DESCR",3)="set or killed."
"RTN","TIUPS106",25,0)
 S TIUARR("VAL",1)=.01
"RTN","TIUPS106",26,0)
 S TIUARR("VAL",2)=.05
"RTN","TIUPS106",27,0)
 S TIUARR("VAL",3)=.06
"RTN","TIUPS106",28,0)
 S TIUARR("VAL",4)=.07
"RTN","TIUPS106",29,0)
 S TIUARR("VAL",5)=.08
"RTN","TIUPS106",30,0)
 S TIUARR("VAL",6)=1202
"RTN","TIUPS106",31,0)
 S TIUARR("VAL",7)=1205
"RTN","TIUPS106",32,0)
 S TIUARR("VAL",8)=1301
"RTN","TIUPS106",33,0)
 S TIUARR("VAL",9)=1405
"RTN","TIUPS106",34,0)
 S TIUARR("VAL",10)=1701
"RTN","TIUPS106",35,0)
 S TIUARR("VAL",11)=2101
"RTN","TIUPS106",36,0)
 S TIUARR("VAL",12)=.02
"RTN","TIUPS106",37,0)
 D CREIXN^DDMOD(.TIUARR,"kW",.TIURES)
"RTN","TIUPS106",38,0)
 ; Compiled xrefs require Activity=R so set NoReIndex flag [DBIA 4754]
"RTN","TIUPS106",39,0)
 S:$G(TIURES) ^DD("IX",+TIURES,"NOREINDEX")=1
"RTN","TIUPS106",40,0)
 Q
"RTN","TIUVPR")
0^2^B10950606
"RTN","TIUVPR",1,0)
TIUVPR ; SLC/JER,MKB - Server fns - lists for VPR ;7/9/96  12:47 [9/21/04 1:07pm]
"RTN","TIUVPR",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**106**;Jun 20, 1997;Build 315
"RTN","TIUVPR",3,0)
 ;
"RTN","TIUVPR",4,0)
NOTES(TIUY,DFN,EARLY,LATE) ; Gets list of Notes
"RTN","TIUVPR",5,0)
 I $S(+$G(DFN)'>0:1,'$D(^DPT(+$G(DFN),0)):1,1:0) Q
"RTN","TIUVPR",6,0)
 D LIST(TIUY,DFN,3,$G(EARLY),$G(LATE))
"RTN","TIUVPR",7,0)
 Q
"RTN","TIUVPR",8,0)
SUMMARY(TIUY,DFN,EARLY,LATE) ; Gets list of Summaries
"RTN","TIUVPR",9,0)
 I $S(+$G(DFN)'>0:1,'$D(^DPT(+$G(DFN),0)):1,1:0) Q
"RTN","TIUVPR",10,0)
 D LIST(TIUY,DFN,244,$G(EARLY),$G(LATE))
"RTN","TIUVPR",11,0)
 Q
"RTN","TIUVPR",12,0)
 ;
"RTN","TIUVPR",13,0)
LIST(TIUY,DFN,CLASS,EARLY,LATE,STATUS) ; Build List of [parent] documents
"RTN","TIUVPR",14,0)
 ;  TIUY    - Return array name, pass by reference
"RTN","TIUVPR",15,0)
 ;  DFN     - Pointer to PATIENT #2
"RTN","TIUVPR",16,0)
 ; [CLASS]  - PN,CR,C,W,A,D,DS,SR,CP,LR  [default=ALL]
"RTN","TIUVPR",17,0)
 ;             or TIU DOCUMENT DEFINITION #8925.1 ien
"RTN","TIUVPR",18,0)
 ; [EARLY]  - FM date/time to begin search
"RTN","TIUVPR",19,0)
 ; [LATE]   - FM date/time to end search
"RTN","TIUVPR",20,0)
 ; [STATUS] - Name of TIU STATUS #8925.6 [default=COMPLETED]
"RTN","TIUVPR",21,0)
 ;
"RTN","TIUVPR",22,0)
 ; Returns @TIUY@(DA)       = ""
"RTN","TIUVPR",23,0)
 ;         @TIUY@("COUNT")  = total# documents
"RTN","TIUVPR",24,0)
 ;
"RTN","TIUVPR",25,0)
 N TIUCOUNT,TIUC,SUB,TIUI,TIUDA,TIU0,TIUTYPE,DAD,DA
"RTN","TIUVPR",26,0)
 S TIUCOUNT=0,TIUY=$NA(^TMP("TIULIST",$J)) K @TIUY
"RTN","TIUVPR",27,0)
 S CLASS=$G(CLASS,"ALL"),STATUS=$G(STATUS,"COMPLETED"),SUB=0
"RTN","TIUVPR",28,0)
 ; accept Class ien, or convert code to ien
"RTN","TIUVPR",29,0)
 I +CLASS=CLASS S TIUC=+CLASS
"RTN","TIUVPR",30,0)
 E  S TIUC=$S(CLASS="ALL":38,CLASS="DS":244,CLASS="SR":$$CLASS("SURGICAL REPORTS"),CLASS="LR":$$CLASS("LR LABORATORY REPORTS"),CLASS="CP":$$CLASS("CLINICAL PROCEDURES"),CLASS="RA":0,1:3)
"RTN","TIUVPR",31,0)
 I "CRWAD"[CLASS S SUB=$S(CLASS="C":30,CLASS="W":31,CLASS="A":25,CLASS="D":27,1:$$CLASS("CONSULTS"))
"RTN","TIUVPR",32,0)
 S EARLY=9999999-+$G(EARLY),TIUI=9999999-$S(+$G(LATE):+$G(LATE),1:3333333)-.000001
"RTN","TIUVPR",33,0)
 F  S TIUI=$O(^TIU(8925,"APTCL",DFN,TIUC,TIUI)) Q:TIUI<1!(TIUI>EARLY)  D
"RTN","TIUVPR",34,0)
 . S TIUDA=0 F  S TIUDA=$O(^TIU(8925,"APTCL",DFN,TIUC,TIUI,TIUDA)) Q:+TIUDA'>0  D
"RTN","TIUVPR",35,0)
 .. Q:$D(@TIUY@(TIUDA))
"RTN","TIUVPR",36,0)
 .. S TIU0=$G(^TIU(8925,TIUDA,0)),TIUTYPE=$G(^TIU(8925.1,+TIU0,0))
"RTN","TIUVPR",37,0)
 .. I $P(TIUTYPE,U,4)="CO" Q
"RTN","TIUVPR",38,0)
 .. I SUB,$P(TIU0,U,4)'=SUB Q
"RTN","TIUVPR",39,0)
 .. S DAD=$S($P(TIUTYPE,U)["ADDENDUM":+$P(TIU0,U,6),1:0),DA=TIUDA
"RTN","TIUVPR",40,0)
 .. I STATUS="COMPLETED",$P(TIU0,U,5)<7!($P(TIU0,U,5)>13)!DAD Q
"RTN","TIUVPR",41,0)
 .. I STATUS="UNSIGNED" Q:'$$UNSIG(TIUDA,DUZ)
"RTN","TIUVPR",42,0)
 .. I DAD Q:$D(@TIUY@(DAD))  S DA=DAD
"RTN","TIUVPR",43,0)
 .. ; add to array
"RTN","TIUVPR",44,0)
 .. S TIUCOUNT=TIUCOUNT+1,@TIUY@(DA)=""
"RTN","TIUVPR",45,0)
 S @TIUY@("COUNT")=$G(TIUCOUNT)
"RTN","TIUVPR",46,0)
 Q
"RTN","TIUVPR",47,0)
 ;
"RTN","TIUVPR",48,0)
CLASS(CLNAME) ; -- Returns the TIU [Document] Class for CLNAME
"RTN","TIUVPR",49,0)
 N TIUY S TIUY=+$O(^TIU(8925.1,"B",CLNAME,0))
"RTN","TIUVPR",50,0)
 I +TIUY>0,$S($P($G(^TIU(8925.1,+TIUY,0)),U,4)="CL":0,$P($G(^(0)),U,4)="DC":0,1:1) S TIUY=0
"RTN","TIUVPR",51,0)
 Q TIUY
"RTN","TIUVPR",52,0)
 ;
"RTN","TIUVPR",53,0)
UNSIG(IEN,USER) ; -- Return 1 or 0, if note IEN is unsigned for USER
"RTN","TIUVPR",54,0)
 I $P(TIU0,U,5)>5 Q 0
"RTN","TIUVPR",55,0)
 I $P($G(^TIU(8925,IEN,12)),U,2)=DUZ Q 1
"RTN","TIUVPR",56,0)
 I $P($G(^TIU(8925,IEN,13)),U,2)=DUZ Q 1
"RTN","TIUVPR",57,0)
 Q 0
"RTN","TIUVPR",58,0)
 ;
"RTN","TIUVPR",59,0)
GET(TIUY,DFN,CLASS,EARLY,LATE) ; Build List of [parent only] documents
"RTN","TIUVPR",60,0)
 ;  TIUY    - Return array, pass name by reference
"RTN","TIUVPR",61,0)
 ;  DFN     - Pointer to PATIENT #2
"RTN","TIUVPR",62,0)
 ;  CLASS   - Pointer to TIU DOCUMENT DEFINITION #8925.1
"RTN","TIUVPR",63,0)
 ; [EARLY]  - FM date/time to begin search
"RTN","TIUVPR",64,0)
 ; [LATE]   - FM date/time to end search
"RTN","TIUVPR",65,0)
 ;
"RTN","TIUVPR",66,0)
 ; Returns @TIUY@(#)        = DA
"RTN","TIUVPR",67,0)
 ;         @TIUY@("COUNT")  = total# documents
"RTN","TIUVPR",68,0)
 ;
"RTN","TIUVPR",69,0)
 N TIUCOUNT,TIUI,DA
"RTN","TIUVPR",70,0)
 S TIUCOUNT=0,TIUY=$NA(^TMP("TIULIST",$J)) K @TIUY
"RTN","TIUVPR",71,0)
 I +$G(CLASS)'>0 S CLASS=38 ;S @TIUY@("COUNT")=0 Q
"RTN","TIUVPR",72,0)
 S EARLY=9999999-+$G(EARLY),TIUI=9999999-$S(+$G(LATE):+$G(LATE),1:3333333)
"RTN","TIUVPR",73,0)
 F  S TIUI=$O(^TIU(8925,"APTCL",DFN,CLASS,TIUI)) Q:TIUI<1!(TIUI>EARLY)  D
"RTN","TIUVPR",74,0)
 . S DA=0 F  S DA=$O(^TIU(8925,"APTCL",DFN,CLASS,TIUI,DA)) Q:+DA'>0  D
"RTN","TIUVPR",75,0)
 . . I +$$ISADDNDM^TIULC1(+DA) Q  ;no addenda
"RTN","TIUVPR",76,0)
 . . I +$$ISCOMP^TIUSRVR1(+DA) Q  ;no components
"RTN","TIUVPR",77,0)
 . . ;I +$G(^TIU(8925,+DA,21)) Q  ;no id children
"RTN","TIUVPR",78,0)
 . . S TIUCOUNT=TIUCOUNT+1
"RTN","TIUVPR",79,0)
 . . S @TIUY@(TIUCOUNT)=DA
"RTN","TIUVPR",80,0)
 S @TIUY@("COUNT")=$G(TIUCOUNT)
"RTN","TIUVPR",81,0)
 Q
"VER")
8.0^22.0
**INSTALL NAME**
GMRC*3.0*80
"BLD",9071,0)
GMRC*3.0*80^CONSULT/REQUEST TRACKING^0^3150414^y
"BLD",9071,4,0)
^9.64PA^^
"BLD",9071,6.3)
29
"BLD",9071,"KRN",0)
^9.67PA^779.2^20
"BLD",9071,"KRN",.4,0)
.4
"BLD",9071,"KRN",.401,0)
.401
"BLD",9071,"KRN",.402,0)
.402
"BLD",9071,"KRN",.403,0)
.403
"BLD",9071,"KRN",.5,0)
.5
"BLD",9071,"KRN",.84,0)
.84
"BLD",9071,"KRN",3.6,0)
3.6
"BLD",9071,"KRN",3.8,0)
3.8
"BLD",9071,"KRN",9.2,0)
9.2
"BLD",9071,"KRN",9.8,0)
9.8
"BLD",9071,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",9071,"KRN",9.8,"NM",1,0)
GMRCAPI^^0^B8248863
"BLD",9071,"KRN",9.8,"NM","B","GMRCAPI",1)

"BLD",9071,"KRN",19,0)
19
"BLD",9071,"KRN",19.1,0)
19.1
"BLD",9071,"KRN",101,0)
101
"BLD",9071,"KRN",409.61,0)
409.61
"BLD",9071,"KRN",771,0)
771
"BLD",9071,"KRN",779.2,0)
779.2
"BLD",9071,"KRN",870,0)
870
"BLD",9071,"KRN",8989.51,0)
8989.51
"BLD",9071,"KRN",8989.52,0)
8989.52
"BLD",9071,"KRN",8994,0)
8994
"BLD",9071,"KRN","B",.4,.4)

"BLD",9071,"KRN","B",.401,.401)

"BLD",9071,"KRN","B",.402,.402)

"BLD",9071,"KRN","B",.403,.403)

"BLD",9071,"KRN","B",.5,.5)

"BLD",9071,"KRN","B",.84,.84)

"BLD",9071,"KRN","B",3.6,3.6)

"BLD",9071,"KRN","B",3.8,3.8)

"BLD",9071,"KRN","B",9.2,9.2)

"BLD",9071,"KRN","B",9.8,9.8)

"BLD",9071,"KRN","B",19,19)

"BLD",9071,"KRN","B",19.1,19.1)

"BLD",9071,"KRN","B",101,101)

"BLD",9071,"KRN","B",409.61,409.61)

"BLD",9071,"KRN","B",771,771)

"BLD",9071,"KRN","B",779.2,779.2)

"BLD",9071,"KRN","B",870,870)

"BLD",9071,"KRN","B",8989.51,8989.51)

"BLD",9071,"KRN","B",8989.52,8989.52)

"BLD",9071,"KRN","B",8994,8994)

"BLD",9071,"QUES",0)
^9.62^^
"BLD",9071,"REQB",0)
^9.611^^
"MBREQ")
1
"PKG",294,-1)
1^1
"PKG",294,0)
CONSULT/REQUEST TRACKING^GMRC^CONSULTS/REQUESTS
"PKG",294,22,0)
^9.49I^1^1
"PKG",294,22,1,0)
3.0^2980101^2980917^11712
"PKG",294,22,1,"PAH",1,0)
80^3150414^1
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","GMRCAPI")
0^1^B8248863
"RTN","GMRCAPI",1,0)
GMRCAPI ;SLC/MKB -- Consult APIs ;8/13/14 11:31
"RTN","GMRCAPI",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**80**;DEC 27, 1997;Build 29
"RTN","GMRCAPI",3,0)
 ; Use of this routine is controlled by IA #6082
"RTN","GMRCAPI",4,0)
 ;
"RTN","GMRCAPI",5,0)
GET(GMRCAR,GMRCDA,GMRCMED)  ;return basic data & list of linked results
"RTN","GMRCAPI",6,0)
 ; Input:
"RTN","GMRCAPI",7,0)
 ;  GMRCAR - array to return list, passed by reference
"RTN","GMRCAPI",8,0)
 ;  GMRCDA - ien from file 123
"RTN","GMRCAPI",9,0)
 ;  GMRCMED- 1 = include Medicine pkg results; 0 = only TIU docs
"RTN","GMRCAPI",10,0)
 ;
"RTN","GMRCAPI",11,0)
 ; Output:
"RTN","GMRCAPI",12,0)
 ;  GMRCAR - array in format:
"RTN","GMRCAPI",13,0)
 ;       GMRCAR(0)    = zero node of record
"RTN","GMRCAPI",14,0)
 ;       GMRCAR(1)    = CP procedure name
"RTN","GMRCAPI",15,0)
 ;       GMRCAR(20)   = Reason for Request (wp)
"RTN","GMRCAPI",16,0)
 ;       GMRCAR(30)   = Prov Dx
"RTN","GMRCAPI",17,0)
 ;       GMRCAR(30.1) = Prov Dx codes
"RTN","GMRCAPI",18,0)
 ;       GMRCAR(50,n) = "ien;global ref," e.g. 5;TIU(8925, or 3;MCAR(691,
"RTN","GMRCAPI",19,0)
 ;
"RTN","GMRCAPI",20,0)
 I '$D(^GMR(123,GMRCDA,0)) Q
"RTN","GMRCAPI",21,0)
 N X,P,RES,CNT
"RTN","GMRCAPI",22,0)
 S GMRCAR(0)=^GMR(123,GMRCDA,0)
"RTN","GMRCAPI",23,0)
 S $P(GMRCAR(0),U,20)="" ;return TIU note in 50 list
"RTN","GMRCAPI",24,0)
 ; resolve GMRC file pointers to external format
"RTN","GMRCAPI",25,0)
 S X=$P(GMRCAR(0),U,5) S:X $P(GMRCAR(0),U,5)=$P($G(^GMR(123.5,X,0)),U)
"RTN","GMRCAPI",26,0)
 S X=$P(GMRCAR(0),U,8) I X,X["123.3" S $P(GMRCAR(0),U,8)=$P($G(^GMR(123.3,+X,0)),U)
"RTN","GMRCAPI",27,0)
 F P=9,10 S X=$P(GMRCAR(0),U,P) I X S $P(GMRCAR(0),U,P)=$$GET1^DIQ(101,X_",",1)
"RTN","GMRCAPI",28,0)
 S X=$P(GMRCAR(0),U,12) S:X $P(GMRCAR(0),U,12)=$P($G(^ORD(100.01,X,0)),U)
"RTN","GMRCAPI",29,0)
 S X=$P(GMRCAR(0),U,13) S:X $P(GMRCAR(0),U,13)=$P($G(^GMR(123.1,X,0)),U)
"RTN","GMRCAPI",30,0)
 ;
"RTN","GMRCAPI",31,0)
 S X=$G(^GMR(123,GMRCDA,1)) I X S GMRCAR(1)=$$EXTERNAL^DILFD(123,1.01,,X)
"RTN","GMRCAPI",32,0)
 I $D(^GMR(123,GMRCDA,20)) M GMRCAR(20)=^(20)
"RTN","GMRCAPI",33,0)
 F X=30,30.1 I $L($G(^GMR(123,GMRCDA,X))) S GMRCAR(X)=^(X) ;Prov Dx
"RTN","GMRCAPI",34,0)
 S RES="",CNT=1 F  S RES=$O(^GMR(123,GMRCDA,50,"B",RES)) Q:RES=""  D
"RTN","GMRCAPI",35,0)
 . I '$G(GMRCMED) Q:RES'["TIU(8925"
"RTN","GMRCAPI",36,0)
 . S GMRCAR(50,CNT)=RES
"RTN","GMRCAPI",37,0)
 . I RES["MCAR" D
"RTN","GMRCAPI",38,0)
 .. N ARR,STR
"RTN","GMRCAPI",39,0)
 .. D MEDLKUP^MCARUTL3(.ARR,+$P(RES,"MCAR(",2),+RES)
"RTN","GMRCAPI",40,0)
 .. I '+ARR K GMRCAR(50,CNT) Q
"RTN","GMRCAPI",41,0)
 .. S STR=$P(ARR,U,9)_U_$P(ARR,U,6)_$S($P(ARR,U,10):"^^^^^^^^1",1:"")
"RTN","GMRCAPI",42,0)
 .. ;  procedure name ^ date.time ^^^^^^^^ 1=has image(s)
"RTN","GMRCAPI",43,0)
 .. S GMRCAR(50,CNT)=GMRCAR(50,CNT)_U_STR
"RTN","GMRCAPI",44,0)
 . S CNT=CNT+1
"RTN","GMRCAPI",45,0)
 Q
"RTN","GMRCAPI",46,0)
 ;
"RTN","GMRCAPI",47,0)
IFC(GMRCDA) ;return IFC information
"RTN","GMRCAPI",48,0)
 ; Input:
"RTN","GMRCAPI",49,0)
 ;  GMRCDA - ien from file 123
"RTN","GMRCAPI",50,0)
 ;
"RTN","GMRCAPI",51,0)
 ; Output:
"RTN","GMRCAPI",52,0)
 ;  IFC fields as a string with these pieces:
"RTN","GMRCAPI",53,0)
 ;  1 - IFC REMOTE SERVICE NAME (#.131)
"RTN","GMRCAPI",54,0)
 ;  2 - REMOTE REQUESTOR PHONE (#.132)
"RTN","GMRCAPI",55,0)
 ;  3 - REMOTE REQUESTOR DIG PAGER (#.133)
"RTN","GMRCAPI",56,0)
 ;  5 - IFC ROLE (#.125)
"RTN","GMRCAPI",57,0)
 ;  6 - REMOTE ORDERING PROVIDER (#.126)
"RTN","GMRCAPI",58,0)
 ;  7 - REMOTE CONSULT FILE ENTRY (#.06)
"RTN","GMRCAPI",59,0)
 ;  8 - ROUTING FACILITY (#.07)
"RTN","GMRCAPI",60,0)
 ;
"RTN","GMRCAPI",61,0)
 I '$D(^GMR(123,GMRCDA,0)) Q ""
"RTN","GMRCAPI",62,0)
 N X0,X12,Y
"RTN","GMRCAPI",63,0)
 S X0=$G(^GMR(123,GMRCDA,0)),X12=$G(^(12)),Y=$G(^(13))
"RTN","GMRCAPI",64,0)
 S $P(Y,U,5,6)=$P(X12,U,5,6)
"RTN","GMRCAPI",65,0)
 S $P(Y,U,7,8)=$P(X0,U,22,23)
"RTN","GMRCAPI",66,0)
 Q Y
"RTN","GMRCAPI",67,0)
 ;
"RTN","GMRCAPI",68,0)
ACT(GMRCAR,GMRCDA) ;return Activity data
"RTN","GMRCAPI",69,0)
 ; Input:
"RTN","GMRCAPI",70,0)
 ;  GMRCAR - array to return list, passed by reference
"RTN","GMRCAPI",71,0)
 ;  GMRCDA - ien from file 123
"RTN","GMRCAPI",72,0)
 ;
"RTN","GMRCAPI",73,0)
 ; Output:
"RTN","GMRCAPI",74,0)
 ;  GMRCAR - array in format:
"RTN","GMRCAPI",75,0)
 ;       GMRCAR(n,0) = zero node of record
"RTN","GMRCAPI",76,0)
 ;       GMRCAR(n,1) = comment (wp)
"RTN","GMRCAPI",77,0)
 ;       GMRCAR(n,2) = two node of record
"RTN","GMRCAPI",78,0)
 ;       GMRCAR(n,3) = three node of record
"RTN","GMRCAPI",79,0)
 ;
"RTN","GMRCAPI",80,0)
 I '$D(^GMR(123,GMRCDA,0)) Q
"RTN","GMRCAPI",81,0)
 N I,X0,X
"RTN","GMRCAPI",82,0)
 S I=0 F  S I=$O(^GMR(123,GMRCDA,40,I)) Q:I<1  S X0=$G(^(I,0)) D
"RTN","GMRCAPI",83,0)
 . ; resolve GMRC file pointers to external format
"RTN","GMRCAPI",84,0)
 . S X=$P(X0,U,2) S:X $P(X0,U,2)=$P($G(^GMR(123.1,X,0)),U)
"RTN","GMRCAPI",85,0)
 . S X=$P(X0,U,6) S:X $P(X0,U,6)=$P($G(^GMR(123.5,X,0)),U)
"RTN","GMRCAPI",86,0)
 . S GMRCAR(I,0)=X0
"RTN","GMRCAPI",87,0)
 . I $D(^GMR(123,GMRCDA,40,I,1)) M GMRCAR(I,1)=^(1)
"RTN","GMRCAPI",88,0)
 . I $D(^GMR(123,GMRCDA,40,I,2)) S GMRCAR(I,2)=^(2)
"RTN","GMRCAPI",89,0)
 . I $D(^GMR(123,GMRCDA,40,I,3)) S GMRCAR(I,3)=^(3)
"RTN","GMRCAPI",90,0)
 Q
"VER")
8.0^22.0
**END**
**END**
